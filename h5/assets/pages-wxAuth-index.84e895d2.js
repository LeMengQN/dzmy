import{r as e,t as a,a as s,az as t,a1 as o,b4 as n,$ as l,W as r,b5 as i,f as d,g as c,w as u,i as m,l as p}from"./index.1a866322.js";import{o as x}from"./uni-app.es.5638d019.js";import{h}from"./methods.10d71805.js";import{u as I}from"./useState.33e874ff.js";import"./index.0e6263ad.js";const f={__name:"index",setup(f){const w=I(["MerchantId"]),{MerchantId:R}=w,b=e({wxData:{nickname:""},backUrl:null});return a(b),h(),s(20),x((e=>{const{backUrl:a,shareData:s,shareId:d,sessionId:c}=e;t("wxdata"),t("wxdataSessionId"),c&&o("nologinSessionId",encodeURIComponent(c)),console.log("wxAuth===>返回数据：",e,R.value),b.backUrl=a,n().then((e=>{if(e.Result){b.wxData=e.Result,o("wxdata",e.Result),l.commit("wxData",e.Result);var s=r("nologinSessionId");o("wxdataSessionId",s),function(e){let a=decodeURIComponent(e),s=R.value||a.split("MerchantId=")[1]?a.split("MerchantId=")[1].slice(0,4):"";i(s).then((e=>{e.Result&&e.Result.mobile&&11==e.Result.mobile.length&&(l.commit("userinfo",e.Result),o("isNewUser",!1)),o("userId",e.Result.id),location.replace(b.backUrl),console.log("授权完成==>",e)})).catch((e=>{}))}(a)}else b.wxData.nickname="error"})).catch((e=>{}))})),(e,a)=>{const s=m;return d(),c(s,{style:{"padding-top":"200rpx","text-align":"center"}},{default:u((()=>[p(" 授权成功,正在返回... ")])),_:1})}}};export{f as default};
