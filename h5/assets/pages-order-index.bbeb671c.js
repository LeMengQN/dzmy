import{r as e,t,a,o as s,ad as o,h as l,an as r,af as c,f as d,g as i,w as n,i as u,k as m,p as f,q as p,F as h,n as g,x,S as y,u as I,j as v,l as S,m as b,V as C,b9 as _,a0 as P,am as T,E as M,y as O,C as w,aq as k,aa as N,D as $}from"./index.1a866322.js";import{_ as L}from"./u-tabs.e88e05c6.js";import{o as j,a as F,c as A,r as B}from"./uni-app.es.5638d019.js";import{_ as z}from"./u-tabs-swiper.1153ed4d.js";import{h as E,i as D,e as q}from"./methods.10d71805.js";import{u as J}from"./useState.33e874ff.js";import{_ as R}from"./plugin-vue_export-helper.21dcd24c.js";import"./u-badge.f7b54aa8.js";import"./index.0e6263ad.js";var H=R({__name:"index",setup(R){const H=R,K=J(["MerchantId","islogin"]),{MerchantId:V,islogin:W}=K;console.log("路由===>",H);const G=e({dataList:[],loadmore:{status:"loadmore",iconType:"flower",loadText:{loadmore:"轻轻上拉",loading:"努力加载中",nomore:"实在没有了"}}}),{dataList:Q,loadmore:U}=t(G),X=a(10),Y=a(2),Z=a(0),ee=a(0),te=a(0),ae=a(0),se=a([{Id:1,name:"课程订单"},{Id:309,name:"活动订单"}]),oe=a([{Id:"",name:"全部"},{Id:1,name:"待付款"},{Id:2,name:"已付款"}]);function le(e){ae.value=e,te.value=0,G.dataList=[],de(1)}function re(e){te.value=e}function ce(){console.log("触底");let e=Y.value++;G.loadmore.status="loading",de(e)}function de(e){o({title:"加载中",mask:!0});let t=G.dataList,a=l(oe.value[te.value]).Id,s=l(se.value[ae.value]).Id,d=4==a?{MainCategoryId:s,StatusBetween:"2|3",CommentStatusText:""+(4==a?"未评论":"")}:1==a?{MainCategoryId:s,Status:0}:2==a?{MainCategoryId:s,StatusBetween:"1|5"}:{MainCategoryId:s,Status:""};console.log("whereField是什么===>",a,"=====",s);let i={permission:"Shop_OnlyOrders",queryField:"Id,TotalPrice,CreateTime,Status,StatusBetween,ShopNumber,StatusText,CommentStatusText,CommentStatus,StatusNo,MerchantId,MerchantName,ProductJson,Paymoney,HaveLeft,ApplyAfter,OrderNo,ProductId,WorkInfoState,MKActivityId,StudentName,PayTime",entityName:"CirclesFinancial.Modals.CreditScore.ShopOrder,CirclesFinancial.Modals",whereField:JSON.stringify(d),orderBy:"CreateTime desc",pageSize:X.value,pageIndex:e};console.log("whereField是什么===>",i),r(i).then((a=>{const s=a.Result;console.log("订单列表===>",s),s&&"object"==typeof s&&s.length>0&&(s.forEach((e=>{e.OrderProducts&&e.OrderProducts.forEach((e=>{e.Picture&&(e.Picture=e.Picture.split(",")[0])}));let t=JSON.stringify(e.TotalPrice),a=t.indexOf(".");a>-1?(e.integer=t.substring(0,a),e.decimal=t.substring(a+1,t.length)):e.integer=t})),G.dataList=e<=1?s:t.concat(s)),setTimeout((()=>{c()}),500)})).catch((e=>{c()}))}return s((()=>{})),E(),j((e=>{e&&e.MerchantId?de(1):location.replace("https://appwx.xuezhilian.com/xzb/index.html#/pages/error/404")})),F((()=>{console.log("页面出现时")})),A((()=>{Z.value=Math.floor(D("headId")),ee.value=document.body.clientHeight,console.log("页面准备好时")})),(e,t)=>{const a=B(x("u-tabs"),L),s=B(x("u-tabs-swiper"),z),o=u,r=O,c=w,j=k,F=N,A=$,E=y;return d(),i(o,{class:""},{default:n((()=>[m(o,{class:"head",id:"headId"},{default:n((()=>[m(a,{"show-bar":!1,list:se.value,"is-scroll":!1,current:ae.value,"active-color":"#393939","inactive-color":"#AAA","font-size":"34",onChange:le},null,8,["list","current"]),m(s,{ref:"tabs","show-bar":!1,list:oe.value,"is-scroll":!1,current:te.value,"active-color":"#fd8b27","inactive-color":"#AAA","font-size":"28",onChange:re},null,8,["list","current"])])),_:1}),m(E,{style:g(`height:${ee.value}px;background-color: #F5F4F9;`),current:te.value,onChange:t[0]||(t[0]=e=>{return t=e,te.value=t.detail.current,G.dataList=[],void de(1);var t})},{default:n((()=>[(d(!0),f(h,null,p(oe.value,((e,t)=>(d(),i(A,{class:"swiper-item box-border",style:g(`padding-top:${Z.value}px;`),key:t},{default:n((()=>[m(F,{"scroll-y":"",style:g(`width: 100%;height:${ee.value-Z.value}px;`),onScrolltolower:ce},{default:n((()=>[(d(!0),f(h,null,p(I(Q),((e,t)=>(d(),i(o,{class:"cellClass",key:t},{default:n((()=>[m(o,{class:"heardClass"},{default:n((()=>[v(' <u-icon name="home-fill" color="#777" size="30"></u-icon> '),v(' <text class="htClass textOverflowClass">{{ item.MerchantName }}</text> '),v(' <u-icon name="arrow-right" color="#999" size="30"></u-icon> '),m(r,{class:"orderTypeClass",style:g({color:0!=e.Status?"#B6B6B6":"#E7383D"})},{default:n((()=>[S(b(e.StatusText),1)])),_:2},1032,["style"])])),_:2},1024),(d(!0),f(h,null,p(e.OrderProducts,((t,a)=>(d(),i(o,{onClick:t=>function(e){console.log("点击订单==>",e.OrderProducts[0].CourseId),e.OrderProducts[0].CourseId<=0?M({url:`/pages/Bingogame/activeall?Id=${e.MKActivityId}&MerchantId=${H.MerchantId}`}):M({url:`/pages/course/courseDetail?Id=${e.ProductId}&MerchantId=${H.MerchantId}`})}(e),key:a,class:"goods-box-single"},{default:n((()=>[m(o,{style:{width:"120rpx"}},{default:n((()=>[m(c,{class:"goods-img",src:t.Picture,mode:"aspectFill"},null,8,["src"])])),_:2},1024),m(o,{class:"right"},{default:n((()=>[m(r,{class:"title clamp"},{default:n((()=>[S(b(t.Title),1)])),_:2},1024),m(r,{class:"attr-box pt-1 pb-1"},{default:n((()=>[S(b(t.Specs)+" x "+b(t.ShopNumber),1)])),_:2},1024),m(r,{class:"attr-box"},{default:n((()=>[S("学员："+b(e.StudentName),1),e.PayTime?(d(),i(r,{key:0,class:"attr-box ml-2"},{default:n((()=>[S("支付时间："+b(e.PayTime?e.PayTime.replace("T"," "):" "),1)])),_:2},1024)):v("v-if",!0)])),_:2},1024),v(' <text class="price">￥{{  Math.round(product.Price * product.ShopNumber * 100) / 100  }}</text> ')])),_:2},1024)])),_:2},1032,["onClick"])))),128)),m(o,{class:"price-box"},{default:n((()=>[m(r,{class:"action-box-text"},{default:n((()=>[S(b(e.CreateTime),1)])),_:2},1024),m(r,{class:"price-box-text"},{default:n((()=>[S("共")])),_:1}),m(r,{class:"price-box-num"},{default:n((()=>[S(b(e.ShopNumber),1)])),_:2},1024),m(r,{class:"price-box-text"},{default:n((()=>[S("件商品 实付款")])),_:1}),m(r,{class:"price-box-price"},{default:n((()=>[S("￥"+b(e.Paymoney),1)])),_:2},1024)])),_:2},1024),9!=e.state?(d(),i(o,{key:0,class:"action-box"},{default:n((()=>[m(r,{class:"font-smallest OrderNo text-body",onLongpress:t=>I(q)(e.OrderNo),selectable:!0},{default:n((()=>[S("订单号:"+b(e.OrderNo),1)])),_:2},1032,["onLongpress"]),m(o,{class:"action-box-action"},{default:n((()=>[0==e.Status?(d(),i(j,{key:0,onClick:a=>function(e,t){console.log("取消订单==>",e,t),C({title:"提示",content:"你确定取消订单?",success:a=>{if(a.confirm){let a={OrderId:e.Id};G.dataList[t].Status=-1,G.dataList[t].StatusText="订单已取消",_(a).then((e=>{"success"==a.Result&&P({title:"订单已取消",icon:"none"})})).catch((e=>{}))}}})}(e,t),class:"grayClass"},{default:n((()=>[S("取消订单")])),_:2},1032,["onClick"])):v("v-if",!0),-1!=e.Status?(d(),i(j,{key:1,onClick:t=>function(e){if(W.value)if(2!=e.Status&&3!=e.Status||"未评论"!=e.CommentStatusText||4!=l(oe.value[te.value]).Id)M({url:`../createOrder/index?Id=${e.Id}&MerchantId=${H.MerchantId}`});else{console.log("查看订单====>",e);let t={Id:e.OrderProducts[0].ProductId};T(t).then((t=>{let a=t.Result;1==a.Product.MainCategoryId&&3==e.Status||2==a.Product.MainCategoryId?(console.log("前往评价==>",a),M({url:`../evaluation/index?ProductId=${e.OrderProducts[0].ProductId}&OrderId=${e.Id}&Picture=${e.OrderProducts[0].Picture}&Title=${e.OrderProducts[0].Title}`})):P({icon:"none",title:"课程未核销不能评价",duration:3e3})})).catch((e=>{}))}else goLogin({url:window.location.href},!0)}(e),class:"grayClass",style:{color:"#E8373D","border-color":"#E8373D"}},{default:n((()=>[S(b(0==e.StatusNo?"付款":2!=e.Status&&3!=e.Status||"未评论"!=e.CommentStatusText||4!=oe.value[te.value].Id?"查看订单":"前往评价"),1)])),_:2},1032,["onClick"])):v("v-if",!0)])),_:2},1024)])),_:2},1024)):v("v-if",!0)])),_:2},1024)))),128)),v(' <u-loadmore :status="loadmore.status" :icon-type="loadmore.iconType"\r\n                        :load-text="loadmore.loadText" /> ')])),_:2},1032,["style"])])),_:2},1032,["style"])))),128))])),_:1},8,["style","current"])])),_:1})}}},[["__scopeId","data-v-fc9e9cd6"]]);export{H as default};
