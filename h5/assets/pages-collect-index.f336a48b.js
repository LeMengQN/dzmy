import{r as e,t,a,o as s,an as o,f as l,g as n,w as i,i as r,l as c,j as u,p as f,q as p,u as d,F as m,k as g,m as h,E as I,V as x,ao as P,a0 as y,C as M,y as T}from"./index.1a866322.js";import{o as v,a as _,b}from"./uni-app.es.5638d019.js";import{h as j}from"./methods.10d71805.js";import{u as C}from"./useState.33e874ff.js";import{_ as w}from"./plugin-vue_export-helper.21dcd24c.js";import"./index.0e6263ad.js";var z=w({__name:"index",setup(w){const z=w,k=C(["MerchantId","islogin"]),{MerchantId:S,islogin:D}=k,L=e({Info:[]}),{Info:N}=t(L);a(2);const E=a(20),F=a(0),q=a(!1);function B(e){let t=[];const a={permission:"Shop-MerchantCollection",queryField:"CreateTime,UserId,Id,MerProId,MerProType,Title,Price,Thumbnail,SpId,MId,Name,Image,ManageTime,Distance,Picture",entityName:"MerchantCollection",whereField:JSON.stringify({}),lon:116.397474,lat:39.906306,orderBy:"CreateTime desc",pageIndex:e,pageSize:E.value};o(a).then((a=>{const s=a.Result;F.value=a.Total,s&&"object"==typeof s&&s.length>0?(s.forEach((e=>{0==e.MerProType?e.Thumbnail||e.Image&&"string"==typeof e.Image&&(e.Thumbnail=e.Image.split(",")[0]):(e.Picture&&"string"==typeof e.Picture?e.Thumbnail=e.Picture.split(",")[0]:e.Picture&&"object"==typeof e.Picture&&(e.Thumbnail=e.Picture[0]),t.push(e))})),L.Info=e<=1?t:L.Info.concat(t)):q.value=!0})).catch((e=>{}))}return s((()=>{})),j(),v((e=>{console.log("路由参数===>",e),e&&e.MerchantId?B(1):location.replace("https://appwx.xuezhilian.com/xzb/index.html#/pages/error/404")})),_((()=>{console.log("页面出现时")})),b((()=>{let e=PageIndex.value++;L.Info.length>=F.value||B(e)})),(e,t)=>{const a=r,s=M,o=T;return l(),n(a,{class:"page"},{default:i((()=>[q.value?(l(),n(a,{key:0,class:"pingjia-null"},{default:i((()=>[c("未有相关记录")])),_:1})):u("v-if",!0),(l(!0),f(m,null,p(d(N),((e,t)=>(l(),n(a,{key:t},{default:i((()=>[g(a,{class:"cellDiv",onClick:t=>function(e,t){D.value?I({url:`../course/courseDetail?Id=${e.MerProId}&MerchantId=${z.MerchantId}`}):goLogin({url:window.location.href},!0)}(e),onLongpress:a=>function(e,t){D.value?x({title:"提示",content:"是否删除该收藏",success:a=>{if(a.confirm){let a={MerProId:e.MerProId,Cancel:1,MerProType:e.MerProType};P(a).then((e=>{e.Result&&(y({title:"取消成功"}),L.Info.splice(t,1))})).catch((()=>{}))}else a.cancel&&console.log("用户点击取消")}}):goLogin({url:window.location.href},!0)}(e,t)},{default:i((()=>[g(s,{src:e.Thumbnail||"../../static/logo.png",class:"imgDiv"},null,8,["src"]),g(a,{class:"flex flex-1 flex-column pl-2"},{default:i((()=>[g(o,{class:"textP",style:{"font-weight":"bold","font-size":"35rpx"}},{default:i((()=>[c(h(e.Title),1)])),_:2},1024),g(o,{class:"textP",style:{"font-size":"30rpx",color:"#E7373B"}},{default:i((()=>[c("￥"+h(e.Price),1)])),_:2},1024),u(' <text class="textP" style="font-size: 30rpx;">商家：{{ item.Name }}</text> '),g(o,{class:"textP",style:{"font-size":"30rpx"}},{default:i((()=>[c("收藏时间："+h(e.CreateTime),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick","onLongpress"])])),_:2},1024)))),128))])),_:1})}}},[["__scopeId","data-v-eea5ffd6"]]);export{z as default};
