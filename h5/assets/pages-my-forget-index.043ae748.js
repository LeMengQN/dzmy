import{r as e,t as o,a as t,o as l,h as a,f as i,g as s,w as n,i as r,p as u,q as c,u as d,F as m,k as f,l as p,a0 as g,bp as h,V as v,aw as b,$ as x,x as y,aq as L,j as C,m as _,bq as w,ay as k,K as V}from"./index.1a866322.js";import{_ as $}from"./u-icon.1541541b.js";import{o as I,a as j,c as E,b as z,r as M}from"./uni-app.es.5638d019.js";import{_ as U}from"./u-field.6c7fbccd.js";import{_ as S}from"./u-button.9dd62910.js";import{_ as T}from"./u-verification-code.1ec03bf7.js";import{h as B,p as D}from"./methods.10d71805.js";import{u as F}from"./useState.33e874ff.js";import{_ as N}from"./plugin-vue_export-helper.21dcd24c.js";import"./index.0e6263ad.js";var q=N({__name:"index",setup(N){const q=/^(((1[3456789][0-9]{1})|(15[0-9]{1}))+\d{8})$/;let A=!1;const G=F(["MerchantId","islogin","InformationData","userinfo"]),{proxy:R}=V(),{MerchantId:Z,islogin:K,InformationData:P,userinfo:W}=G,H=e({forgetList:[{focus:!1,icon:"iconzhanghao",maxLength:11,type:"mobile",inputType:"number",placeholder:"请输入手机号",value:"",loginValue:"",disabled:!1},{focus:!1,icon:"iconmima",maxLength:20,type:"password",inputType:"password",placeholder:"请输入新密码",value:"",passShow:!1},{focus:!1,icon:"iconmima",maxLength:20,type:"password",inputType:"password",placeholder:"再输入新密码",value:"",passShow:!1},{focus:!1,icon:"iconmessage",maxLength:6,type:"mobileCode",inputType:"number",placeholder:"验证码",value:""}]}),{forgetList:J}=o(H);t(""),t(0);const O=t(!1);t(!1);const Q=t("获取验证码");function X(){let e=a(W.value).mobile;if(H.forgetList[0].loginValue,H.forgetList[0].disabled,H.forgetList[3].imgShow,H.forgetList[3].value,!q.test(e))return uni.$u.toast("手机号输入不正确"),!1;if(D("check",e).over)return void uni.$u.toast("该手机号验证码获取过于频繁，请稍后再试！",3e3);let o={mobile:e,validation:""};console.log(a(R.$refs.uCode[0].canGetCode)),R.$refs.uCode[0].canGetCode?(uni.$u.toast("正在获取验证码"),w(o).then((e=>{R.$refs.uCode[0].start()})).catch((e=>{}))):uni.$u.toast("倒计时结束后再发送")}function Y(e){Q.value=e}function ee(){a(W.value).mobile;let e=H.forgetList[0].loginValue,o=H.forgetList[0].disabled,t=H.forgetList[1].value,l=H.forgetList[2].value,i=H.forgetList[3].value;if(!q.test(e)&&!q.test(Mobile))return g({icon:"none",title:"手机号输入不正确"}),!1;if(!/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z\\W]{8,16}$/.test(t))return void g({icon:"none",title:"密码必须包含字母和数字,且在8~16位之间",duration:3e3});if(/[\u4E00-\u9FA5]/i.test(t))return void g({icon:"none",title:"暂不支持中文密码哦"});if(t!==l)return void g({icon:"none",title:"两次密码输入不一致"});if(!i||6!=i.length)return void g({icon:"none",title:"验证码不正确"});if(O.value)return;let s={checkCode:i,Password:t,Mobile:o?"":Mobile};h(s).then((e=>{e&&"成功"==e.Result&&(H.forgetList.forEach((e=>{e.value=""})),x.commit("islogin",!1),x.commit("userinfo",{}),v({title:"提示",content:"修改成功,请重新登录",showCancel:!1,success:()=>{b(A?{delta:2}:{delta:1})}}))})).catch((e=>{}))}return l((()=>{})),B(),I((e=>{if(e.setUpBoole&&(A=e.setUpBoole,K.value)){console.log("手机号==>",a(W.value).mobile);const e=a(W.value).mobile;if(e){H.forgetList[0].loginValue=e;let o=new RegExp("(\\d{3})(\\d{4})(\\d{4})");H.forgetList[0].value=e.replace(o,"$1****$3"),H.forgetList[0].disabled=!0}}})),j((()=>{console.log("页面出现时")})),E((()=>{console.log("页面准备好时")})),z((()=>{console.log("页面触底时")})),(e,o)=>{const t=M(y("u-icon"),$),l=r,a=k,g=M(y("u-field"),U),h=M(y("u-button"),S),v=M(y("u-verification-code"),T),b=L;return i(),s(l,{class:"page flex flex-column align-center forget"},{default:n((()=>[(i(!0),u(m,null,c(d(J),((e,o)=>(i(),u(m,{key:o},["mobile"==e.type?(i(),s(l,{key:0,class:"formItemDiv bottomLine"},{default:n((()=>[e.icon?(i(),s(l,{key:0,class:"cellIcon bottomClass"},{default:n((()=>[f(t,{name:"account-fill",color:"#E8393E",size:"35"})])),_:1})):C("v-if",!0),f(a,{maxlength:e.maxLength||11,"confirm-hold":!1,disabled:e.disabled,placeholder:e.placeholder,modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,modelModifiers:{trim:!0},class:"mobileInput"},null,8,["maxlength","disabled","placeholder","modelValue","onUpdate:modelValue"])])),_:2},1024)):C("v-if",!0),"password"==e.type?(i(),s(l,{key:1,class:"formItemDiv bottomLine"},{default:n((()=>[e.icon?(i(),s(l,{key:0,class:"cellIcon bottomClass"},{default:n((()=>[f(t,{name:"account-fill",color:"#E8393E",size:"35"})])),_:1})):C("v-if",!0),f(g,{"border-bottom":!1,maxlength:e.maxLength||20,"confirm-hold":!1,type:e.passShow?"text":"password",placeholder:e.placeholder,modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,modelModifiers:{trim:!0},class:"mobileInput"},null,8,["maxlength","type","placeholder","modelValue","onUpdate:modelValue"]),f(t,{name:"eye-fill",color:"#999",size:"35",onClick:o=>function(e){e.passShow=!e.passShow}(e)},null,8,["onClick"])])),_:2},1024)):C("v-if",!0),"mobileCode"==e.type?(i(),s(l,{key:2,class:"formItemDiv bottomLine"},{default:n((()=>[e.icon?(i(),s(l,{key:0,class:"cellIcon bottomClass"},{default:n((()=>[f(t,{name:"account-fill",color:"#E8393E",size:"35"})])),_:1})):C("v-if",!0),f(g,{"border-bottom":!1,maxlength:e.maxLength||20,"confirm-hold":!1,type:e.inputType||"text",placeholder:e.placeholder,modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,modelModifiers:{trim:!0}},{right:n((()=>[f(h,{class:"codeBtn",size:"mini",onClick:X},{default:n((()=>[p(_(Q.value),1)])),_:1})])),_:2},1032,["maxlength","type","placeholder","modelValue","onUpdate:modelValue"]),f(v,{ref_for:!0,ref:"uCode",onChange:Y},null,512),C(' <input :maxlength="item.maxLength || 20" :confirm-hold="false" :type="item.inputType || \'text\'"\n                    @focus="onFocus(item)" @blur="onBlur(item)" :placeholder="item.placeholder"\n                    v-model.trim="item.value" class="mobileInput" style="width:320rpx;" />\n                <text @click="getForgetCodeClick" class="iconClose mobileCodeText clickBefore"\n                    :style="{ color: forgetNum == 0 ? \'#E8393E\' : \'#999\' }">{{ forgetNum == 0 ? \'获取验证码\' : forgetNum ==\n                            -1 ? \'发送中...\' : `(${forgetNum})秒后获取`\n                    }}</text> ')])),_:2},1024)):C("v-if",!0)],64)))),128)),f(b,{disabled:O.value,onClick:ee,class:"loginBtn",type:"warn"},{default:n((()=>[p("确认修改")])),_:1},8,["disabled"])])),_:1})}}},[["__scopeId","data-v-3f2972a7"]]);export{q as default};
