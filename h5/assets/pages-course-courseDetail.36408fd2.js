import{r as e,t as a,a as t,V as l,B as s,ab as o,ac as n,am as c,s as i,an as r,u,f as d,g as f,w as m,j as h,i as p,k as y,p as b,q as g,F as I,n as v,l as _,m as x,a8 as w,E as P,ao as C,a0 as S,W as M,ap as k,C as D,S as j,y as L,x as N,aq as z,aa as R,v as T,D as $}from"./index.1a866322.js";import{_ as E}from"./u-parse.58a54c5b.js";import{o as F,a as O,c as q,r as A}from"./uni-app.es.5638d019.js";import{_ as B}from"./u-icon.1541541b.js";import{_ as V}from"./u-popup.ac74065a.js";import{s as U,b as X,n as Y,j as J,g as W,d as G,i as H}from"./methods.10d71805.js";import{u as K}from"./useState.33e874ff.js";import{w as Q}from"./wechatSdk.8caabd54.js";import{_ as Z}from"./plugin-vue_export-helper.21dcd24c.js";import"./index.0e6263ad.js";var ee=Z({__name:"courseDetail",setup(Z){const ee=Z,ae=K(["islogin","saveOem","systemObj","userinfo","wxMerchantId"]);console.log("路由===>",ee);const te=e({MerchantData:{},ProductData:{},SkuListData:[],basicPrice:{},StudentId:"",StudentName:"",studentList:[]}),{MerchantData:le,ProductData:se,SkuListData:oe,basicPrice:ne,StudentId:ce,StudentName:ie,studentList:re}=a(te),{islogin:ue,saveOem:de,systemObj:fe,userinfo:me,wxMerchantId:he}=ae,pe=t(200),ye=t(!1);t(50);const be=t(!1),ge=t(0),Ie=t(1);function ve(){he.value?function(){if(ue.value){let e={merchantId:ee.MerchantId};w(e).then((e=>{ye.value=!0;const a=e.Result;Array.isArray(a)&&(te.studentList=a,a.length>0?(te.StudentId=a[0].Id,te.StudentName=a[0].StudentName):te.StudentId="")})).catch((e=>{}))}else W({url:window.location.href},!0),console.log("登录状态===>",ue.value),ye.value=!1}():l({title:"提示",content:"该机构微信商户号暂未配置",showCancel:!1,confirmColor:"#fd8b27"})}function _e(){ue.value?(P({url:`../my/student/index?fromUrl=commodity&MerchantId=${ee.MerchantId}`}),ye.value=!1):W({url:window.location.href},!0)}function xe(){if(ue.value){const e={MerProId:ee.Id,Cancel:be.value?1:0,MerProType:2};C(e).then((e=>{e.Result&&(be.value=!be.value,S({icon:"none",title:"已"+(be.value?"收藏":"取消")}))})).catch((e=>{}))}else W({url:window.location.href},!0)}function we(){if(console.log("到底有没有登录===>",ue.value),M("loginuser"),ue.value){if(!te.StudentId)return ye.value=!1,void l({title:"提示",content:"你还未添加学员，是否前往添加？",showCancel:!1,success:e=>{_e()}});let e={};const a=te.SkuListData[ge.value].type;let t={ProductId:te.ProductData.Id,ShopNumber:Ie.value,Specs:a};te.ProductData&&1==te.ProductData.MainCategoryId&&(t.StudentId=ce.value,t.CourseLength=te.SkuListData[ge.value].CourseLength,t.ClassTypeId=te.SkuListData[ge.value].ClassTypeId,t.CourseId=te.ProductData.CourseId),e={BuyProduct:JSON.stringify([{...t}]),studentId:te.StudentId,studentName:te.StudentName},console.log("购买信息==>",e),k(e).then((e=>{const a=e.Message;if(a)S({icon:"none",title:a,duration:3e3});else{const a=e.Result;"object"==typeof a&&(console.log("有没有进else",a||""),ye.value=!1,P({url:`../createOrder/index?Id=${a.Id}&MerchantId=${ee.MerchantId}`}))}})).catch((e=>{}))}else W({url:window.location.href},!0)}return F((()=>{ee&&ee.MerchantId?(async function(e){let a=await c({Id:e,merchantId:ee.MerchantId});console.log("课程详情===>"),a.Result.Product.Picture=U(`${a.Result.Product.Picture}`,","),te.MerchantData=a.Result.Merchant,te.ProductData=a.Result.Product,te.SkuListData=a.Result.SkuList,te.basicPrice={Price:a.Result.Product.Price,...X(a.Result.Product.Price)},te.SkuListData.map(((e,a)=>{let t="班型",l="type";e[t].length&&(e[l]=e[t]),delete e[t]})),i({title:a.Result.Product.Title}),function(e){let a=window.location.href,t=e;console.log("分享信息==>",t),Q({share_title:t.Product.Title,share_desc:t.Merchant.Name+"："+t.Merchant.Address,share_link:a,share_cover:t.Product.Picture[0]})}(a.Result)}(ee.Id),function(){let e={permission:"Shop-MerchantCollection",queryField:"CreateTime,UserId,Id,MerProId,MerProType",entityName:"MerchantCollection",whereField:JSON.stringify({MerProId:ee.Id,MerProType:2})};r(e).then((e=>{const a=e.Result;a&&a.length>0&&(be.value=!0)})).catch((e=>{}))}()):location.replace("https://appwx.xuezhilian.com/xzb/index.html#/pages/error/404")})),O((()=>{ee&&3085==ee.MerchantId&&l({title:"提示",content:"本站为“学支联公众号版”演示站点，内容及课程为演示数据。请勿购买！",showCancel:!1,confirmColor:"#fd8b27",confirmText:"我知道了"})})),q((()=>{let e=s().select("#headId");console.log("页面准备好时",e)})),o((()=>{n()})),(e,a)=>{const t=D,l=$,s=j,o=L,n=p,c=A(N("u-parse"),E),i=A(N("u-icon"),B),r=z,w=R,P=A(N("u-popup"),V);return u(se).Picture?(d(),f(n,{key:0,class:"anquan"},{default:m((()=>[y(s,{style:v(`height:${pe.value}px;`),"indicator-dots":!u(se).Picture.length>0,autoplay:!0,interval:3e3,duration:1e3},{default:m((()=>[(d(!0),b(I,null,g(u(se).Picture,((e,a)=>(d(),f(l,{key:a},{default:m((()=>[y(t,{id:`iamnode${a}`,class:"swiper-image",src:e,mode:"widthFix",onLoad:e=>{return 0==a?(t="iamnode0",void(pe.value=H(t))):"";var t},onClick:a=>u(G)(e)},null,8,["id","src","onLoad","onClick"])])),_:2},1024)))),128))])),_:1},8,["style","indicator-dots"]),y(n,{class:"page"},{default:m((()=>[y(n,{class:"merch-detail"},{default:m((()=>[y(n,{class:"moneyDiv font-lg color-main"},{default:m((()=>[y(o,{class:"font-small"},{default:m((()=>[_("￥")])),_:1}),y(o,{class:"font-weight-600"},{default:m((()=>[_(x(u(ne).integer||"0")+".",1)])),_:1}),y(o,{class:"font-weight-600"},{default:m((()=>[_(x(u(ne).decimal||"00"),1)])),_:1})])),_:1}),y(n,{class:"merch-tag flex justify-between"},{default:m((()=>[y(n,{class:""},{default:m((()=>[y(o,{class:"mainType"},{default:m((()=>[_(x(1==u(se).MainCategoryId?"课程":"商品"),1)])),_:1}),y(o,{class:"titleText"},{default:m((()=>[_(x(u(se).Title||""),1)])),_:1})])),_:1}),u(se).MonthlySales?(d(),f(o,{key:0,class:"sellType"},{default:m((()=>[_("月销量："+x(u(se).MonthlySales),1)])),_:1})):h("v-if",!0)])),_:1})])),_:1})])),_:1}),y(n,{class:"page"},{default:m((()=>[y(c,{html:u(se).Description,"lazy-load":!0},null,8,["html"])])),_:1}),y(n,{class:"btn-con flex align-center justify-between",style:v("android"==u(J)()?"padding-bottom: 14rpx;":""),id:"btnBox"},{default:m((()=>[y(n,{class:"w-30 flex justify-around"},{default:m((()=>[y(i,{name:"home",label:"官网",color:"#fd8b27",size:"40","label-pos":"bottom","label-size":"24",onClick:a[0]||(a[0]=e=>u(Y)(`/pages/index/index?MerchantId=${ee.MerchantId}`))}),y(i,{name:"kefu-ermai",label:"客服",color:"#fd8b27",size:"40","label-pos":"bottom","label-size":"24",onClick:a[1]||(a[1]=e=>u(Y)(`/pages/chat/index?MerchantId=${ee.MerchantId}`))}),y(i,{name:be.value?"star-fill":"star",label:"收藏",color:"#fd8b27",size:"40","label-pos":"bottom","label-size":"24",onClick:xe},null,8,["name"])])),_:1}),y(r,{class:"pop-btn text-white",onClick:a[2]||(a[2]=a=>e.$u.debounce(ve,500))},{default:m((()=>[_("立即购买")])),_:1})])),_:1},8,["style"]),y(P,{modelValue:ye.value,"onUpdate:modelValue":a[4]||(a[4]=e=>ye.value=e),mode:"bottom","border-radius":"14",closeable:!0,"close-icon":"close-circle-fill","close-icon-color":"#fd8b27","close-icon-size":"50"},{default:m((()=>[y(n,{class:"pop-con",style:v("android"==u(J)()?"padding-bottom: 14rpx;":"")},{default:m((()=>[y(n,{class:"flex align-center"},{default:m((()=>[y(t,{class:"pop-con-img",src:u(se).Picture[0]},null,8,["src"]),y(n,{class:"moneyDiv font-md color-main ml-2"},{default:m((()=>[y(o,{class:"font-small"},{default:m((()=>[_("￥")])),_:1}),y(o,{class:"font-weight-600"},{default:m((()=>[_(x(u(oe)[ge.value].Price||"0"),1)])),_:1})])),_:1})])),_:1}),y(n,{class:""},{default:m((()=>[y(n,{class:"font-small mt-2 mb-1"},{default:m((()=>[_("选择学员")])),_:1}),y(w,{class:"scrollContainer w-90","scroll-x":"","show-scrollbar":!1},{default:m((()=>[y(n,{class:"flex flex-nowrap XYDiv"},{default:m((()=>[y(i,{onClick:_e,class:"addxy flex justify-center align-center mr-2",name:"man-add-fill",color:"#EEEEEE",size:"70"}),(d(!0),b(I,null,g(u(re),((e,a)=>(d(),f(n,{onClick:a=>function(e,a){te.StudentId=e.Id,te.StudentName=e.StudentName,console.log("选择学员==>",e)}(e),key:a,style:v({backgroundColor:e.Id==u(ce)?2==e.Sex?"#fbc8cf":"#409EFF":"#eee"}),class:"XYCell flex flex-column justify-center align-center"},{default:m((()=>[y(n,{class:"sex-icon-con position-relative"},{default:m((()=>[y(t,{src:e.AvatarImg||"../../static/logo.png",mode:"",class:"headImg"},null,8,["src"]),2==e.Sex?(d(),f(i,{key:0,class:"sex-icon",name:"woman",color:"#FD577B",size:"30"})):(d(),f(i,{key:1,class:"sex-icon",name:"man",color:"#409EFF",size:"30"}))])),_:2},1024),y(o,{class:"XYP textOverflowClass scrollContainer"},{default:m((()=>[_(x(e.StudentName),1)])),_:2},1024)])),_:2},1032,["onClick","style"])))),128))])),_:1})])),_:1})])),_:1}),y(n,{class:""},{default:m((()=>[y(n,{class:"font-small mt-2 mb-1"},{default:m((()=>[_("班型("+x(`${u(oe)[ge.value].CourseLength}`)+"课时)",1)])),_:1}),y(n,{class:"flex flex-wrap justify-between"},{default:m((()=>[(d(!0),b(I,null,g(u(oe),((e,a)=>(d(),f(n,{key:a,class:T(["type-item",ge.value==a?"type-item-t":""]),onClick:e=>function(e,a){ge.value=a}(0,a)},{default:m((()=>[_(x(e.type),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),y(r,{class:"buy-btn-s text-white",onClick:a[3]||(a[3]=a=>e.$u.debounce(we,500))},{default:m((()=>[_("完成")])),_:1})])),_:1},8,["style"])])),_:1},8,["modelValue"])])),_:1})):h("v-if",!0)}}},[["__scopeId","data-v-6786b0b3"]]);export{ee as default};
