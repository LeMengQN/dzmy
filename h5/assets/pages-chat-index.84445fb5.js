import{B as e,ba as t,x as o,f as l,g as a,w as s,k as i,j as n,n as c,v as r,l as u,m as d,i as p,y as m,p as y,q as f,F as g,D as h,S as v,a as S,r as b,h as k,t as x,bv as C,ab as _,K as I,u as z,a0 as w,ad as B,af as M,ai as j,bw as $,aa as N,ay as T,bx as L,by as D,C as P}from"./index.1a866322.js";import{_ as U}from"./u-icon.1541541b.js";import{r as V,o as R,c as W,e as F}from"./uni-app.es.5638d019.js";import{_ as G}from"./plugin-vue_export-helper.21dcd24c.js";import{_ as O}from"./u-button.9dd62910.js";import{_ as A}from"./u-rate.cf6c98db.js";import{_ as H}from"./u-popup.ac74065a.js";import{h as J,j as E,d as q}from"./methods.10d71805.js";import{u as K}from"./useState.33e874ff.js";import"./index.0e6263ad.js";var Q=G({emits:["close","getMore"],props:{list:{type:Array,default:()=>[]},type:{type:String,default:"warning"},volumeIcon:{type:Boolean,default:!0},moreIcon:{type:Boolean,default:!1},closeIcon:{type:Boolean,default:!1},autoplay:{type:Boolean,default:!0},color:{type:String,default:""},bgColor:{type:String,default:""},show:{type:Boolean,default:!0},fontSize:{type:[Number,String],default:26},volumeSize:{type:[Number,String],default:34},speed:{type:[Number,String],default:160},playState:{type:String,default:"play"},padding:{type:[Number,String],default:"18rpx 24rpx"}},data:()=>({textWidth:0,boxWidth:0,animationDuration:"10s",animationPlayState:"paused",showText:""}),watch:{list:{immediate:!0,handler(e){this.showText=e.join("，"),this.$nextTick((()=>{this.initSize()}))}},playState(e){this.animationPlayState="play"==e?"running":"paused"},speed(e){this.initSize()}},computed:{computeColor(){return this.color?this.color:"none"==this.type?"#606266":this.type},textStyle(){let e={};return this.color?e.color=this.color:"none"==this.type&&(e.color="#606266"),e.fontSize=this.fontSize+"rpx",e},computeBgColor(){return this.bgColor?this.bgColor:"none"==this.type?"transparent":void 0}},mounted(){this.$nextTick((()=>{this.initSize()}))},methods:{initSize(){let o=[],l=new Promise(((t,o)=>{e().in(this).select("#u-notice-content").boundingClientRect().exec((e=>{this.textWidth=e[0].width,t()}))}));o.push(l),Promise.all(o).then((()=>{this.animationDuration=this.textWidth/t(this.speed)+"s",this.animationPlayState="paused",setTimeout((()=>{"play"==this.playState&&this.autoplay&&(this.animationPlayState="running")}),10)}))},click(e){this.$emit("click")},close(){this.$emit("close")},getMore(){this.$emit("getMore")}}},[["render",function(e,t,y,f,g,h){const v=V(o("u-icon"),U),S=p,b=m;return y.show?(l(),a(S,{key:0,class:r(["u-notice-bar",[y.type?`u-type-${y.type}-light-bg`:""]]),style:c({background:h.computeBgColor,padding:y.padding})},{default:s((()=>[i(S,{class:"u-direction-row"},{default:s((()=>[i(S,{class:"u-icon-wrap"},{default:s((()=>[y.volumeIcon?(l(),a(v,{key:0,class:"u-left-icon",name:"volume-fill",size:y.volumeSize,color:h.computeColor},null,8,["size","color"])):n("v-if",!0)])),_:1}),i(S,{class:"u-notice-box",id:"u-notice-box"},{default:s((()=>[i(S,{class:"u-notice-content",id:"u-notice-content",style:c({animationDuration:g.animationDuration,animationPlayState:g.animationPlayState})},{default:s((()=>[i(b,{class:r(["u-notice-text",["u-type-"+y.type]]),onClick:h.click,style:c([h.textStyle])},{default:s((()=>[u(d(g.showText),1)])),_:1},8,["onClick","style","class"])])),_:1},8,["style"])])),_:1}),i(S,{class:"u-icon-wrap"},{default:s((()=>[y.moreIcon?(l(),a(v,{key:0,onClick:h.getMore,class:"u-right-icon",name:"arrow-right",size:26,color:h.computeColor},null,8,["onClick","color"])):n("v-if",!0),y.closeIcon?(l(),a(v,{key:1,onClick:h.close,class:"u-right-icon",name:"close",size:24,color:h.computeColor},null,8,["onClick","color"])):n("v-if",!0)])),_:1})])),_:1})])),_:1},8,["style","class"])):n("v-if",!0)}],["__scopeId","data-v-ae750f0c"]]);var X=G({emits:["close","getMore","end"],props:{list:{type:Array,default:()=>[]},type:{type:String,default:"warning"},volumeIcon:{type:Boolean,default:!0},moreIcon:{type:Boolean,default:!1},closeIcon:{type:Boolean,default:!1},autoplay:{type:Boolean,default:!0},color:{type:String,default:""},bgColor:{type:String,default:""},direction:{type:String,default:"row"},show:{type:Boolean,default:!0},fontSize:{type:[Number,String],default:26},duration:{type:[Number,String],default:2e3},volumeSize:{type:[Number,String],default:34},speed:{type:Number,default:160},isCircular:{type:Boolean,default:!0},mode:{type:String,default:"horizontal"},playState:{type:String,default:"play"},disableTouch:{type:Boolean,default:!0},padding:{type:[Number,String],default:"18rpx 24rpx"}},computed:{computeColor(){return this.color?this.color:"none"==this.type?"#606266":this.type},textStyle(){let e={};return this.color?e.color=this.color:"none"==this.type&&(e.color="#606266"),e.fontSize=this.fontSize+"rpx",e},vertical(){return"horizontal"!=this.mode},computeBgColor(){return this.bgColor?this.bgColor:"none"==this.type?"transparent":void 0}},data:()=>({}),methods:{click(e){this.$emit("click",e)},close(){this.$emit("close")},getMore(){this.$emit("getMore")},change(e){e.detail.current==this.list.length-1&&this.$emit("end")}}},[["render",function(e,t,m,S,b,k){const x=V(o("u-icon"),U),C=p,_=h,I=v;return l(),a(C,{class:r(["u-notice-bar",[m.type?`u-type-${m.type}-light-bg`:""]]),style:c({background:k.computeBgColor,padding:m.padding})},{default:s((()=>[i(C,{class:"u-icon-wrap"},{default:s((()=>[m.volumeIcon?(l(),a(x,{key:0,class:"u-left-icon",name:"volume-fill",size:m.volumeSize,color:k.computeColor},null,8,["size","color"])):n("v-if",!0)])),_:1}),i(I,{"disable-touch":m.disableTouch,onChange:k.change,autoplay:m.autoplay&&"play"==m.playState,vertical:k.vertical,circular:"",interval:m.duration,class:"u-swiper"},{default:s((()=>[(l(!0),y(g,null,f(m.list,((e,t)=>(l(),a(_,{key:t,class:"u-swiper-item"},{default:s((()=>[i(C,{class:r(["u-news-item u-line-1",["u-type-"+m.type]]),style:c([k.textStyle]),onClick:e=>k.click(t)},{default:s((()=>[u(d(e),1)])),_:2},1032,["style","onClick","class"])])),_:2},1024)))),128))])),_:1},8,["disable-touch","onChange","autoplay","vertical","interval"]),i(C,{class:"u-icon-wrap"},{default:s((()=>[m.moreIcon?(l(),a(x,{key:0,onClick:k.getMore,class:"u-right-icon",name:"arrow-right",size:26,color:k.computeColor},null,8,["onClick","color"])):n("v-if",!0),m.closeIcon?(l(),a(x,{key:1,onClick:k.close,class:"u-right-icon",name:"close",size:24,color:k.computeColor},null,8,["onClick","color"])):n("v-if",!0)])),_:1})])),_:1},8,["style","class"])}],["__scopeId","data-v-00a2a660"]]);var Y=G({name:"u-notice-bar",emits:["click","close","getMore","end"],props:{list:{type:Array,default:()=>[]},type:{type:String,default:"warning"},volumeIcon:{type:Boolean,default:!0},volumeSize:{type:[Number,String],default:34},moreIcon:{type:Boolean,default:!1},closeIcon:{type:Boolean,default:!1},autoplay:{type:Boolean,default:!0},color:{type:String,default:""},bgColor:{type:String,default:""},mode:{type:String,default:"horizontal"},show:{type:Boolean,default:!0},fontSize:{type:[Number,String],default:28},duration:{type:[Number,String],default:2e3},speed:{type:[Number,String],default:160},isCircular:{type:Boolean,default:!0},playState:{type:String,default:"play"},disableTouch:{type:Boolean,default:!0},borderRadius:{type:[Number,String],default:0},padding:{type:[Number,String],default:"18rpx 24rpx"},noListHidden:{type:Boolean,default:!0}},computed:{isShow(){return 0!=this.show&&(1!=this.noListHidden||0!=this.list.length)}},methods:{click(e){this.$emit("click",e)},close(){this.$emit("close")},getMore(){this.$emit("getMore")},end(){this.$emit("end")}}},[["render",function(e,t,i,r,u,d){const m=V(o("u-row-notice"),Q),y=V(o("u-column-notice"),X),f=p;return d.isShow?(l(),a(f,{key:0,class:"u-notice-bar-wrap",style:c({borderRadius:i.borderRadius+"rpx"})},{default:s((()=>["horizontal"==i.mode&&i.isCircular?(l(),a(m,{key:0,type:i.type,color:i.color,bgColor:i.bgColor,list:i.list,volumeIcon:i.volumeIcon,moreIcon:i.moreIcon,volumeSize:i.volumeSize,closeIcon:i.closeIcon,mode:i.mode,fontSize:i.fontSize,speed:i.speed,playState:i.playState,padding:i.padding,onGetMore:d.getMore,onClose:d.close,onClick:d.click},null,8,["type","color","bgColor","list","volumeIcon","moreIcon","volumeSize","closeIcon","mode","fontSize","speed","playState","padding","onGetMore","onClose","onClick"])):n("v-if",!0),"vertical"==i.mode||"horizontal"==i.mode&&!i.isCircular?(l(),a(y,{key:1,type:i.type,color:i.color,bgColor:i.bgColor,list:i.list,volumeIcon:i.volumeIcon,moreIcon:i.moreIcon,closeIcon:i.closeIcon,mode:i.mode,volumeSize:i.volumeSize,"disable-touch":i.disableTouch,fontSize:i.fontSize,duration:i.duration,playState:i.playState,padding:i.padding,onGetMore:d.getMore,onClose:d.close,onClick:d.click,onEnd:d.end},null,8,["type","color","bgColor","list","volumeIcon","moreIcon","closeIcon","mode","volumeSize","disable-touch","fontSize","duration","playState","padding","onGetMore","onClose","onClick","onEnd"])):n("v-if",!0)])),_:1},8,["style"])):n("v-if",!0)}],["__scopeId","data-v-20080d31"]]);var Z=G({__name:"index",setup(e){const t=e,m=K(["MerchantId","islogin","userinfo","saveOem","chatList"]),{MerchantId:h,islogin:v,userinfo:G,saveOem:Q,chatList:X}=m,Z=S(null),ee=S(!1),te=S(5),oe=["#ffc454","#ffb409","#ff9500"],le=[{emoji:"😡",text:"很不满",score:1},{emoji:"🙁",text:"不满",score:2},{emoji:"😐",text:"一般",score:3},{emoji:"🙂",text:"满意",score:4},{emoji:"😁",text:"很满意",score:5}],ae=b({message:{from:k(G.value).id,msg:"",source:2,type:1,to:null,MerchantId:t.MerchantId},talkList:[],keyWordList:[],ajax:{rows:5,page:1,flag:!0,loading:!0,loadText:"正在获取消息"},content:""}),{proxy:{$nextTick:se,$forceUpdate:ie}}=I(),{message:ne,talkList:ce,ajax:re,content:ue,keyWordList:de}=x(ae);function pe(){ae.message.msg?(B({title:"正在发送"}),setTimeout((()=>{M();let e=ae.message;var t;e.to=X.value[0].from,t=e,L({data:JSON.stringify(t),success:function(e){console.log("发送消息==>",JSON.stringify(t))}});const o={...e,time:"",hide:!1,Img:G.value.headPicture,ID:(new Date).getTime()};ae.talkList.push(o),se((()=>{ae.message.msg="",j({scrollTop:999999,duration:0})}))}),500)):w({title:"请输入有效的内容",icon:"none"})}function me(){B({title:"提交中...",mask:!0});let e={FromUserId:k(G.value).id,ToUserId:X.value[0].from,Grade:te.value};$(e).then((()=>{M(),ee.value=!1;const e={from:k(G.value).id,msg:`评价本次服务<${le[te.value-1].emoji}${le[te.value-1].text}>`,type:1,source:2};ae.talkList.push(e)})).catch((e=>{}))}return J(),R((e=>{e.MerchantId?(console.log("客服消息===>",X.value[0]),X.value[0]&&(Z.value=!0,ae.talkList.push(X.value[0])),C((function(e){const t=JSON.parse(e.data);switch(console.log(`%cWebscoket=收到服务器内容：==>${e.data}`,"color: #FFD34F;font-size: 18px;"),console.log("Webscoket=收到服务器内容：==>",t),t.type){case"1":case"2":case"customservice":case"merchantservice":"客服繁忙"==t.msg?(t.msg="[系统消息]客服繁忙或不在线",ae.talkList.push(t),Z.value=!1):(ae.talkList.push(t),Z.value=!0);break;case"online":Z.value=!0,t.msg="[系统消息]客服上线",ae.talkList.push(t);break;case"offline":Z.value=!1;break;case"4":ee.value=!0}}))):location.replace("https://appwx.xuezhilian.com/xzb/index.html#/pages/error/404")})),W((()=>{se((()=>{}))})),_((()=>{})),F((e=>{e.scrollTop})),(e,m)=>{const h=V(o("u-notice-bar"),Y),v=p,S=P,b=V(o("u-icon"),U),k=N,x=T,C=V(o("u-button"),O),_=V(o("u-rate"),A),I=V(o("u-popup"),H);return l(),a(v,{class:"page chat"},{default:s((()=>[n(' <view class="tips text-white size_12 text-center" :class="{ \'show\':ajax.loading }" @tap="getHistoryMsg">{{ajax.loadText}}</view> '),!Z.value||z(ce).length<=0?(l(),a(v,{key:0,class:"notice"},{default:s((()=>[i(h,{mode:"horizontal",list:["当前客服不在线，感谢你的来访......"]},null,8,["list"])])),_:1})):n("v-if",!0),z(ce)&&z(ce).length>0?(l(),a(v,{key:1,class:"box-1",id:"list-box"},{default:s((()=>[i(v,{class:"talk-list"},{default:s((()=>[(l(!0),y(g,null,f(z(ce),((e,t)=>(l(),a(v,{key:t},{default:s((()=>[i(v,{class:r(["item flex_col",2==e.source?"push":"pull"])},{default:s((()=>[e.Img?(l(),a(S,{key:0,src:e.Img,mode:"aspectFill",class:"pic"},null,8,["src"])):(l(),a(b,{key:1,name:"server-fill",color:"#fd8b27",size:"80"})),"2"==e.type?(l(),a(v,{key:2,class:"content"},{default:s((()=>[i(S,{class:"chatimg",onClick:t=>z(q)(e.msg),src:e.msg,mode:"widthFix"},null,8,["onClick","src"])])),_:2},1024)):(l(),a(v,{key:3,class:"content"},{default:s((()=>[u(d(e.msg),1)])),_:2},1024))])),_:2},1032,["class"])])),_:2},1024)))),128))])),_:1})])),_:1})):n("v-if",!0),i(v,{class:"box-2",style:c("android"==z(E)()?"padding-bottom: 14rpx;":"")},{default:s((()=>[i(k,{"scroll-x":""},{default:s((()=>[i(v,{class:"flex pl-1 pr-1 box-border"},{default:s((()=>[(l(!0),y(g,null,f(z(de),((e,o)=>(l(),a(v,{class:"white-space-n mr-2 p-1",key:e.Id,onClick:o=>function(e){const o=Z.value;if(console.log("对方是否在线?=====>",o),ae.message.msg=e.UserReply,pe(),!o){const o={msg:e.UserReply,MerchantId:t.MerchantId};D(o).then((e=>{const t=e.Result;if(t){const e={msg:t,type:1,source:1};ae.talkList.push(e)}})).catch((e=>{}))}}(e)},{default:s((()=>[u(d(e.UserReply),1)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),i(v,{class:"flex_col"},{default:s((()=>[i(v,{class:"flex_grow"},{default:s((()=>[i(x,{type:"text",class:"content",modelValue:z(ne).msg,"onUpdate:modelValue":m[0]||(m[0]=e=>z(ne).msg=e),placeholder:"开始互动吧","placeholder-style":"color:#DDD;","cursor-spacing":6},null,8,["modelValue"])])),_:1}),i(C,{class:"send",onClick:m[1]||(m[1]=t=>e.$u.throttle(pe,500))},{default:s((()=>[u("发送")])),_:1})])),_:1})])),_:1},8,["style"]),i(I,{modelValue:ee.value,"onUpdate:modelValue":m[4]||(m[4]=e=>ee.value=e),mode:"center"},{default:s((()=>[i(v,{class:"flex flex-column justify-center align-center p-3"},{default:s((()=>[i(v,{class:"mb-2 font-smaller"},{default:s((()=>[u("请对本次服务进行评价")])),_:1}),i(_,{modelValue:te.value,"onUpdate:modelValue":m[2]||(m[2]=e=>te.value=e),"min-count":1,colors:oe,size:"50"},null,8,["modelValue"]),i(C,{class:"mt-2 w-100",type:"warning",onClick:m[3]||(m[3]=t=>e.$u.throttle(me,500))},{default:s((()=>[u("提交")])),_:1})])),_:1})])),_:1},8,["modelValue"]),n(' <view class="live_btm">\n            <input v-model="message.msg" type="text" placeholder="开始互动吧~" />\n            <button class="send" @click="tapSend">发送</button>\n        </view> ')])),_:1})}}},[["__scopeId","data-v-3bcc8bff"]]);export{Z as default};
