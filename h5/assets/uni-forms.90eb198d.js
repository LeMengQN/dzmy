import{aO as t,f as e,g as i,w as s,H as a,v as r,n,j as o,i as l,x as u,aP as h,k as m,Y as d,a0 as c,V as f,l as p,m as g,y as b,aQ as y,aR as k}from"./index.1a866322.js";import{_ as v}from"./plugin-vue_export-helper.21dcd24c.js";import{r as w}from"./uni-app.es.5638d019.js";class _{constructor(e,i){this.options=e,this.animation=t(e),this.currentStepAnimates={},this.next=0,this.$=i}_nvuePushAnimates(t,e){let i=this.currentStepAnimates[this.next],s={};if(s=i||{styles:{},config:{}},x.includes(t)){s.styles.transform||(s.styles.transform="");let i="";"rotate"===t&&(i="deg"),s.styles.transform+=`${t}(${e+i}) `}else s.styles[t]=`${e}`;this.currentStepAnimates[this.next]=s}_animateRun(t={},e={}){let i=this.$.$refs.ani.ref;if(i)return new Promise(((s,a)=>{nvueAnimation.transition(i,{styles:t,...e},(t=>{s()}))}))}_nvueNextAnimate(t,e=0,i){let s=t[e];if(s){let{styles:a,config:r}=s;this._animateRun(a,r).then((()=>{e+=1,this._nvueNextAnimate(t,e,i)}))}else this.currentStepAnimates={},"function"==typeof i&&i(),this.isEnd=!0}step(t={}){return this.animation.step(t),this}run(t){this.$.animationData=this.animation.export(),this.$.timer=setTimeout((()=>{"function"==typeof t&&t()}),this.$.durationTime)}}const x=["matrix","matrix3d","rotate","rotate3d","rotateX","rotateY","rotateZ","scale","scale3d","scaleX","scaleY","scaleZ","skew","skewX","skewY","translate","translate3d","translateX","translateY","translateZ"];function C(t,e){if(e)return clearTimeout(e.timer),new _(t,e)}x.concat(["opacity","backgroundColor"],["width","height","left","right","top","bottom"]).forEach((t=>{_.prototype[t]=function(...e){return this.animation[t](...e),this}}));var S=v({name:"uniTransition",emits:["click","change"],props:{show:{type:Boolean,default:!1},modeClass:{type:[Array,String],default:()=>"fade"},duration:{type:Number,default:300},styles:{type:Object,default:()=>({})},customClass:{type:String,default:""}},data:()=>({isShow:!1,transform:"",opacity:1,animationData:{},durationTime:300,config:{}}),watch:{show:{handler(t){t?this.open():this.isShow&&this.close()},immediate:!0}},computed:{stylesObject(){let t={...this.styles,"transition-duration":this.duration/1e3+"s"},e="";for(let i in t){e+=this.toLine(i)+":"+t[i]+";"}return e},transformStyles(){return"transform:"+this.transform+";opacity:"+this.opacity+";"+this.stylesObject}},created(){this.config={duration:this.duration,timingFunction:"ease",transformOrigin:"50% 50%",delay:0},this.durationTime=this.duration},methods:{init(t={}){t.duration&&(this.durationTime=t.duration),this.animation=C(Object.assign(this.config,t),this)},onClick(){this.$emit("click",{detail:this.isShow})},step(t,e={}){if(this.animation){for(let e in t)try{"object"==typeof t[e]?this.animation[e](...t[e]):this.animation[e](t[e])}catch(i){console.error(`方法 ${e} 不存在`)}return this.animation.step(e),this}},run(t){this.animation&&this.animation.run(t)},open(){clearTimeout(this.timer),this.transform="",this.isShow=!0;let{opacity:t,transform:e}=this.styleInit(!1);void 0!==t&&(this.opacity=t),this.transform=e,this.$nextTick((()=>{this.timer=setTimeout((()=>{this.animation=C(this.config,this),this.tranfromInit(!1).step(),this.animation.run(),this.$emit("change",{detail:this.isShow})}),20)}))},close(t){this.animation&&this.tranfromInit(!0).step().run((()=>{this.isShow=!1,this.animationData=null,this.animation=null;let{opacity:t,transform:e}=this.styleInit(!1);this.opacity=t||1,this.transform=e,this.$emit("change",{detail:this.isShow})}))},styleInit(t){let e={transform:""},i=(t,i)=>{"fade"===i?e.opacity=this.animationType(t)[i]:e.transform+=this.animationType(t)[i]+" "};return"string"==typeof this.modeClass?i(t,this.modeClass):this.modeClass.forEach((e=>{i(t,e)})),e},tranfromInit(t){let e=(t,e)=>{let i=null;"fade"===e?i=t?0:1:(i=t?"-100%":"0","zoom-in"===e&&(i=t?.8:1),"zoom-out"===e&&(i=t?1.2:1),"slide-right"===e&&(i=t?"100%":"0"),"slide-bottom"===e&&(i=t?"100%":"0")),this.animation[this.animationMode()[e]](i)};return"string"==typeof this.modeClass?e(t,this.modeClass):this.modeClass.forEach((i=>{e(t,i)})),this.animation},animationType:t=>({fade:t?1:0,"slide-top":`translateY(${t?"0":"-100%"})`,"slide-right":`translateX(${t?"0":"100%"})`,"slide-bottom":`translateY(${t?"0":"100%"})`,"slide-left":`translateX(${t?"0":"-100%"})`,"zoom-in":`scaleX(${t?1:.8}) scaleY(${t?1:.8})`,"zoom-out":`scaleX(${t?1:1.2}) scaleY(${t?1:1.2})`}),animationMode:()=>({fade:"opacity","slide-top":"translateY","slide-right":"translateX","slide-bottom":"translateY","slide-left":"translateX","zoom-in":"scale","zoom-out":"scale"}),toLine:t=>t.replace(/([A-Z])/g,"-$1").toLowerCase()}},[["render",function(t,u,h,m,d,c){const f=l;return d.isShow?(e(),i(f,{key:0,ref:"ani",animation:d.animationData,class:r(h.customClass),style:n(c.transformStyles),onClick:c.onClick},{default:s((()=>[a(t.$slots,"default")])),_:3},8,["animation","class","style","onClick"])):o("v-if",!0)}]]);var A=v({name:"uniPopup",components:{keypress:{name:"Keypress",props:{disable:{type:Boolean,default:!1}},mounted(){const t={esc:["Esc","Escape"],tab:"Tab",enter:"Enter",space:[" ","Spacebar"],up:["Up","ArrowUp"],left:["Left","ArrowLeft"],right:["Right","ArrowRight"],down:["Down","ArrowDown"],delete:["Backspace","Delete","Del"]};document.addEventListener("keyup",(e=>{if(this.disable)return;const i=Object.keys(t).find((i=>{const s=e.key,a=t[i];return a===s||Array.isArray(a)&&a.includes(s)}));i&&setTimeout((()=>{this.$emit(i,{})}),0)}))},render:()=>{}}},emits:["change","maskClick"],props:{animation:{type:Boolean,default:!0},type:{type:String,default:"center"},isMaskClick:{type:Boolean,default:null},maskClick:{type:Boolean,default:null},backgroundColor:{type:String,default:"none"},safeArea:{type:Boolean,default:!0},maskBackgroundColor:{type:String,default:"rgba(0, 0, 0, 0.4)"}},watch:{type:{handler:function(t){this.config[t]&&this[this.config[t]](!0)},immediate:!0},isDesktop:{handler:function(t){this.config[t]&&this[this.config[this.type]](!0)},immediate:!0},maskClick:{handler:function(t){this.mkclick=t},immediate:!0},isMaskClick:{handler:function(t){this.mkclick=t},immediate:!0},showPopup(t){document.getElementsByTagName("body")[0].style.overflow=t?"hidden":"visible"}},data(){return{duration:300,ani:[],showPopup:!1,showTrans:!1,popupWidth:0,popupHeight:0,config:{top:"top",bottom:"bottom",center:"center",left:"left",right:"right",message:"top",dialog:"center",share:"bottom"},maskClass:{position:"fixed",bottom:0,top:0,left:0,right:0,backgroundColor:"rgba(0, 0, 0, 0.4)"},transClass:{position:"fixed",left:0,right:0},maskShow:!0,mkclick:!0,popupstyle:this.isDesktop?"fixforpc-top":"top"}},computed:{isDesktop(){return this.popupWidth>=500&&this.popupHeight>=500},bg(){return""===this.backgroundColor||"none"===this.backgroundColor?"transparent":this.backgroundColor}},mounted(){(()=>{const{windowWidth:t,windowHeight:e,windowTop:i,safeArea:s,screenHeight:a,safeAreaInsets:r}=d();this.popupWidth=t,this.popupHeight=e+(i||0),s&&this.safeArea?this.safeAreaInsets=r.bottom:this.safeAreaInsets=0})()},unmounted(){this.setH5Visible()},created(){null===this.isMaskClick&&null===this.maskClick?this.mkclick=!0:this.mkclick=null!==this.isMaskClick?this.isMaskClick:this.maskClick,this.animation?this.duration=300:this.duration=0,this.messageChild=null,this.clearPropagation=!1,this.maskClass.backgroundColor=this.maskBackgroundColor},methods:{setH5Visible(){document.getElementsByTagName("body")[0].style.overflow="visible"},closeMask(){this.maskShow=!1},disableMask(){this.mkclick=!1},clear(t){t.stopPropagation(),this.clearPropagation=!0},open(t){this.showPopup&&(clearTimeout(this.timer),this.showPopup=!1);t&&-1!==["top","center","bottom","left","right","message","dialog","share"].indexOf(t)||(t=this.type),this.config[t]?(this[this.config[t]](),this.$emit("change",{show:!0,type:t})):console.error("缺少类型：",t)},close(t){this.showTrans=!1,this.$emit("change",{show:!1,type:this.type}),clearTimeout(this.timer),this.timer=setTimeout((()=>{this.showPopup=!1}),300)},touchstart(){this.clearPropagation=!1},onTap(){this.clearPropagation?this.clearPropagation=!1:(this.$emit("maskClick"),this.mkclick&&this.close())},top(t){this.popupstyle=this.isDesktop?"fixforpc-top":"top",this.ani=["slide-top"],this.transClass={position:"fixed",left:0,right:0,backgroundColor:this.bg},t||(this.showPopup=!0,this.showTrans=!0,this.$nextTick((()=>{this.messageChild&&"message"===this.type&&this.messageChild.timerClose()})))},bottom(t){this.popupstyle="bottom",this.ani=["slide-bottom"],this.transClass={position:"fixed",left:0,right:0,bottom:0,paddingBottom:this.safeAreaInsets+"px",backgroundColor:this.bg},t||(this.showPopup=!0,this.showTrans=!0)},center(t){this.popupstyle="center",this.ani=["zoom-out","fade"],this.transClass={position:"fixed",display:"flex",flexDirection:"column",bottom:0,left:0,right:0,top:0,justifyContent:"center",alignItems:"center"},t||(this.showPopup=!0,this.showTrans=!0)},left(t){this.popupstyle="left",this.ani=["slide-left"],this.transClass={position:"fixed",left:0,bottom:0,top:0,backgroundColor:this.bg,display:"flex",flexDirection:"column"},t||(this.showPopup=!0,this.showTrans=!0)},right(t){this.popupstyle="right",this.ani=["slide-right"],this.transClass={position:"fixed",bottom:0,right:0,top:0,backgroundColor:this.bg,display:"flex",flexDirection:"column"},t||(this.showPopup=!0,this.showTrans=!0)}}},[["render",function(t,d,c,f,p,g){const b=w(u("uni-transition"),S),y=l,k=h("keypress");return p.showPopup?(e(),i(y,{key:0,class:r(["uni-popup",[p.popupstyle,g.isDesktop?"fixforpc-z-index":""]])},{default:s((()=>[m(y,{onTouchstart:g.touchstart},{default:s((()=>[p.maskShow?(e(),i(b,{key:"1",name:"mask","mode-class":"fade",styles:p.maskClass,duration:p.duration,show:p.showTrans,onClick:g.onTap},null,8,["styles","duration","show","onClick"])):o("v-if",!0),m(b,{key:"2","mode-class":p.ani,name:"content",styles:p.transClass,duration:p.duration,show:p.showTrans,onClick:g.onTap},{default:s((()=>[m(y,{class:r(["uni-popup__wrapper",[p.popupstyle]]),style:n({backgroundColor:g.bg}),onClick:g.clear},{default:s((()=>[a(t.$slots,"default",{},void 0,!0)])),_:3},8,["style","class","onClick"])])),_:3},8,["mode-class","styles","duration","show","onClick"])])),_:3},8,["onTouchstart"]),p.maskShow?(e(),i(k,{key:0,onEsc:g.onTap},null,8,["onEsc"])):o("v-if",!0)])),_:3},8,["class"])):o("v-if",!0)}],["__scopeId","data-v-95b08782"]]);var T=v({name:"uniFormsItem",options:{virtualHost:!0},provide(){return{uniFormItem:this}},inject:{form:{from:"uniForm",default:null}},props:{rules:{type:Array,default:()=>null},name:{type:[String,Array],default:""},required:{type:Boolean,default:!1},label:{type:String,default:""},labelWidth:{type:[String,Number],default:""},labelAlign:{type:String,default:""},errorMessage:{type:[String,Boolean],default:""},leftIcon:String,iconColor:{type:String,default:"#606266"}},data:()=>({errMsg:"",isRequired:!1,userRules:null,localLabelAlign:"left",localLabelWidth:"65px",localLabelPos:"left",border:!1,isFirstBorder:!1}),computed:{msg(){return this.errorMessage||this.errMsg}},watch:{"form.formRules"(t){this.init()},"form.labelWidth"(t){this.localLabelWidth=this._labelWidthUnit(t)},"form.labelPosition"(t){this.localLabelPos=this._labelPosition()},"form.labelAlign"(t){}},created(){this.init(!0),this.name&&this.form&&this.$watch((()=>this.form._getDataValue(this.name,this.form.localData)),((t,e)=>{if(!this.form._isEqual(t,e)){const e=this.itemSetValue(t);this.onFieldChange(e,!1)}}),{immediate:!1})},unmounted(){this.__isUnmounted=!0,this.unInit()},methods:{setRules(t=null){this.userRules=t,this.init(!1)},setValue(){},async onFieldChange(t,e=!0){const{formData:i,localData:s,errShowType:a,validateCheck:r,validateTrigger:n,_isRequiredField:o,_realName:l}=this.form,u=l(this.name);t||(t=this.form.formData[u]);const h=this.itemRules.rules&&this.itemRules.rules.length;if(!this.validator||!h||0===h)return;const m=o(this.itemRules.rules||[]);let d=null;return"bind"===n||e?(d=await this.validator.validateUpdate({[u]:t},i),m||void 0!==t&&""!==t||(d=null),d&&d.errorMessage?("undertext"===a&&(this.errMsg=d?d.errorMessage:""),"toast"===a&&c({title:d.errorMessage||"校验错误",icon:"none"}),"modal"===a&&f({title:"提示",content:d.errorMessage||"校验错误"})):this.errMsg="",r(d||null)):this.errMsg="",d||null},init(t=!1){const{validator:e,formRules:i,childrens:s,formData:a,localData:r,_realName:n,labelWidth:o,_getDataValue:l,_setDataValue:u}=this.form||{};if(this.localLabelAlign=this._justifyContent(),this.localLabelWidth=this._labelWidthUnit(o),this.localLabelPos=this._labelPosition(),this.isRequired=this.required,this.form&&t&&s.push(this),!e||!i)return;this.form.isFirstBorder||(this.form.isFirstBorder=!0,this.isFirstBorder=!0),this.group&&(this.group.isFirstBorder||(this.group.isFirstBorder=!0,this.isFirstBorder=!0)),this.border=this.form.border;const h=n(this.name),m=this.userRules||this.rules;"object"==typeof i&&m&&(i[h]={rules:m},e.updateSchema(i));const d=i[h]||{};this.itemRules=d,this.validator=e,this.itemSetValue(l(this.name,r)),this.isRequired=this._isRequired()},unInit(){if(this.form){const{childrens:t,formData:e,_realName:i}=this.form;t.forEach(((t,s)=>{t===this&&(this.form.childrens.splice(s,1),delete e[i(t.name)])}))}},itemSetValue(t){const e=this.form._realName(this.name),i=this.itemRules.rules||[],s=this.form._getValue(e,t,i);return this.form._setDataValue(e,this.form.formData,s),s},clearValidate(){this.errMsg=""},_isRequired(){return this.required},_justifyContent(){if(this.form){const{labelAlign:t}=this.form;let e=this.labelAlign?this.labelAlign:t;if("left"===e)return"flex-start";if("center"===e)return"center";if("right"===e)return"flex-end"}return"flex-start"},_labelWidthUnit(t){return this.num2px(this.labelWidth?this.labelWidth:t||(this.label?65:"auto"))},_labelPosition(){return this.form&&this.form.labelPosition||"left"},isTrigger:(t,e,i)=>"submit"!==t&&t?"bind":void 0===t?"bind"!==e?e?"submit":""===i?"bind":"submit":"bind":"submit",num2px:t=>"number"==typeof t?`${t}px`:t}},[["render",function(t,u,h,d,c,f){const y=b,k=l;return e(),i(k,{class:r(["uni-forms-item",["is-direction-"+c.localLabelPos,c.border?"uni-forms-item--border":"",c.border&&c.isFirstBorder?"is-first-border":""]])},{default:s((()=>[a(t.$slots,"label",{},(()=>[m(k,{class:r(["uni-forms-item__label",{"no-label":!h.label&&!c.isRequired}]),style:n({width:c.localLabelWidth,justifyContent:c.localLabelAlign})},{default:s((()=>[c.isRequired?(e(),i(y,{key:0,class:"is-required"},{default:s((()=>[p("*")])),_:1})):o("v-if",!0),m(y,null,{default:s((()=>[p(g(h.label),1)])),_:1})])),_:1},8,["class","style"])]),!0),m(k,{class:"uni-forms-item__content"},{default:s((()=>[a(t.$slots,"default",{},void 0,!0),m(k,{class:r(["uni-forms-item__error",{"msg--active":f.msg}])},{default:s((()=>[m(y,null,{default:s((()=>[p(g(f.msg),1)])),_:1})])),_:1},8,["class"])])),_:3})])),_:3},8,["class"])}],["__scopeId","data-v-a4ca4a44"]]),$={email:/^\S+?@\S+?\.\S+?$/,idcard:/^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/,url:new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://|//)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$","i")};const M={int:"integer",bool:"boolean",double:"number",long:"number",password:"string"};function j(t,e=""){["label"].forEach((e=>{void 0===t[e]&&(t[e]="")}));let i=e;for(let s in t){let e=new RegExp("{"+s+"}");i=i.replace(e,t[s])}return i}const D={integer:t=>D.number(t)&&parseInt(t,10)===t,string:t=>"string"==typeof t,number:t=>!isNaN(t)&&"number"==typeof t,boolean:function(t){return"boolean"==typeof t},float:function(t){return D.number(t)&&!D.integer(t)},array:t=>Array.isArray(t),object:t=>"object"==typeof t&&!D.array(t),date:t=>t instanceof Date,timestamp(t){return!(!this.integer(t)||Math.abs(t).toString().length>16)},file:t=>"string"==typeof t.url,email:t=>"string"==typeof t&&!!t.match($.email)&&t.length<255,url:t=>"string"==typeof t&&!!t.match($.url),pattern(t,e){try{return new RegExp(t).test(e)}catch(i){return!1}},method:t=>"function"==typeof t,idcard:t=>"string"==typeof t&&!!t.match($.idcard),"url-https"(t){return this.url(t)&&t.startsWith("https://")},"url-scheme":t=>t.startsWith("://"),"url-web":t=>!1};const R={required:(t,e,i)=>t.required&&function(t,e){return null==t||"string"==typeof t&&!t||!(!Array.isArray(t)||t.length)||"object"===e&&!Object.keys(t).length}(e,t.format||typeof e)?j(t,t.errorMessage||i.required):null,range(t,e,i){const{range:s,errorMessage:a}=t;let r=new Array(s.length);for(let o=0;o<s.length;o++){const t=s[o];D.object(t)&&void 0!==t.value?r[o]=t.value:r[o]=t}let n=!1;return Array.isArray(e)?n=new Set(e.concat(r)).size===r.length:r.indexOf(e)>-1&&(n=!0),n?null:j(t,a||i.enum)},rangeNumber(t,e,i){if(!D.number(e))return j(t,t.errorMessage||i.pattern.mismatch);let{minimum:s,maximum:a,exclusiveMinimum:r,exclusiveMaximum:n}=t,o=r?e<=s:e<s,l=n?e>=a:e>a;return void 0!==s&&o?j(t,t.errorMessage||i.number[r?"exclusiveMinimum":"minimum"]):void 0!==a&&l?j(t,t.errorMessage||i.number[n?"exclusiveMaximum":"maximum"]):void 0!==s&&void 0!==a&&(o||l)?j(t,t.errorMessage||i.number.range):null},rangeLength(t,e,i){if(!D.string(e)&&!D.array(e))return j(t,t.errorMessage||i.pattern.mismatch);let s=t.minLength,a=t.maxLength,r=e.length;return void 0!==s&&r<s?j(t,t.errorMessage||i.length.minLength):void 0!==a&&r>a?j(t,t.errorMessage||i.length.maxLength):void 0!==s&&void 0!==a&&(r<s||r>a)?j(t,t.errorMessage||i.length.range):null},pattern:(t,e,i)=>D.pattern(t.pattern,e)?null:j(t,t.errorMessage||i.pattern.mismatch),format(t,e,i){var s=Object.keys(D),a=M[t.format]?M[t.format]:t.format||t.arrayType;return s.indexOf(a)>-1&&!D[a](e)?j(t,t.errorMessage||i.typeError):null},arrayTypeFormat(t,e,i){if(!Array.isArray(e))return j(t,t.errorMessage||i.typeError);for(let s=0;s<e.length;s++){const a=e[s];let r=this.format(t,a,i);if(null!==r)return r}return null}};class P extends class{constructor(t){this._message=t}async validateRule(t,e,i,s,a){var r=null;let n=e.rules;if(n.findIndex((t=>t.required))<0){if(null==i)return r;if("string"==typeof i&&!i.length)return r}var o=this._message;if(void 0===n)return o.default;for(var l=0;l<n.length;l++){let u=n[l],h=this._getValidateType(u);if(Object.assign(u,{label:e.label||`["${t}"]`}),R[h]&&null!=(r=R[h](u,i,o)))break;if(u.validateExpr){let t=Date.now();if(!1===u.validateExpr(i,a,t)){r=this._getMessage(u,u.errorMessage||this._message.default);break}}if(u.validateFunction&&null!==(r=await this.validateFunction(u,i,s,a,h)))break}return null!==r&&(r=o.TAG+r),r}async validateFunction(t,e,i,s,a){let r=null;try{let n=null;const o=await t.validateFunction(t,e,s||i,(t=>{n=t}));(n||"string"==typeof o&&o||!1===o)&&(r=this._getMessage(t,n||o,a))}catch(n){r=this._getMessage(t,n.message,a)}return r}_getMessage(t,e,i){return j(t,e||t.errorMessage||this._message[i]||e.default)}_getValidateType(t){var e="";return t.required?e="required":t.format?e="format":t.arrayType?e="arrayTypeFormat":t.range?e="range":void 0!==t.maximum||void 0!==t.minimum?e="rangeNumber":void 0!==t.maxLength||void 0!==t.minLength?e="rangeLength":t.pattern?e="pattern":t.validateFunction&&(e="validateFunction"),e}}{constructor(t,e){super(P.message),this._schema=t,this._options=e||null}updateSchema(t){this._schema=t}async validate(t,e){let i=this._checkFieldInSchema(t);return i||(i=await this.invokeValidate(t,!1,e)),i.length?i[0]:null}async validateAll(t,e){let i=this._checkFieldInSchema(t);return i||(i=await this.invokeValidate(t,!0,e)),i}async validateUpdate(t,e){let i=this._checkFieldInSchema(t);return i||(i=await this.invokeValidateUpdate(t,!1,e)),i.length?i[0]:null}async invokeValidate(t,e,i){let s=[],a=this._schema;for(let r in a){let n=a[r],o=await this.validateRule(r,n,t[r],t,i);if(null!=o&&(s.push({key:r,errorMessage:o}),!e))break}return s}async invokeValidateUpdate(t,e,i){let s=[];for(let a in t){let r=await this.validateRule(a,this._schema[a],t[a],t,i);if(null!=r&&(s.push({key:a,errorMessage:r}),!e))break}return s}_checkFieldInSchema(t){var e=Object.keys(t),i=Object.keys(this._schema);if(new Set(e.concat(i)).size===i.length)return"";var s=e.filter((t=>i.indexOf(t)<0));return[{key:"invalid",errorMessage:j({field:JSON.stringify(s)},P.message.TAG+P.message.defaultInvalid)}]}}P.message=new function(){return{TAG:"",default:"验证错误",defaultInvalid:"提交的字段{field}在数据库中并不存在",validateFunction:"验证无效",required:"{label}必填",enum:"{label}超出范围",timestamp:"{label}格式无效",whitespace:"{label}不能为空",typeError:"{label}类型无效",date:{format:"{label}日期{value}格式无效",parse:"{label}日期无法解析,{value}无效",invalid:"{label}日期{value}无效"},length:{minLength:"{label}长度不能少于{minLength}",maxLength:"{label}长度不能超过{maxLength}",range:"{label}必须介于{minLength}和{maxLength}之间"},number:{minimum:"{label}不能小于{minimum}",maximum:"{label}不能大于{maximum}",exclusiveMinimum:"{label}不能小于等于{minimum}",exclusiveMaximum:"{label}不能大于等于{maximum}",range:"{label}必须介于{minimum}and{maximum}之间"},pattern:{mismatch:"{label}格式不匹配"}}};const O=(t,e,i)=>{const s=i.find((t=>{return t.format&&("int"===(e=t.format)||"double"===e||"number"===e||"timestamp"===e);var e})),a=i.find((t=>t.format&&"boolean"===t.format||"bool"===t.format));return s&&(e=e||0===e?B(Number(e))?Number(e):e:null),a&&(e=!!q(e)&&e),e},F=(t,e)=>I(e,t),N=(t,e={})=>{const i=E(t);if("object"==typeof i&&Array.isArray(i)&&i.length>1){return i.reduce(((t,e)=>t+`#${e}`),"_formdata_")}return i[0]||t},V=t=>{let e=t.replace("_formdata_#","");return e=e.split("#").map((t=>B(t)?Number(t):t)),e},L=(t,e,i)=>("object"!=typeof t||E(e).reduce(((t,e,s,a)=>s===a.length-1?(t[e]=i,null):(e in t||(t[e]=/^[0-9]{1,}$/.test(a[s+1])?[]:{}),t[e])),t),t);function E(t){return Array.isArray(t)?t:t.replace(/\[/g,".").replace(/\]/g,"").split(".")}const I=(t,e,i="undefined")=>{let s=E(e).reduce(((t,e)=>(t||{})[e]),t);return s&&void 0===s?i:s},B=t=>!isNaN(Number(t)),q=t=>"boolean"==typeof t;var W=v({name:"uniForms",emits:["validate","submit"],options:{virtualHost:!0},props:{value:{type:Object,default:()=>null},modelValue:{type:Object,default:()=>null},model:{type:Object,default:()=>null},rules:{type:Object,default:()=>({})},errShowType:{type:String,default:"undertext"},validateTrigger:{type:String,default:"submit"},labelPosition:{type:String,default:"left"},labelWidth:{type:[String,Number],default:""},labelAlign:{type:String,default:"left"},border:{type:Boolean,default:!1}},provide(){return{uniForm:this}},data:()=>({formData:{},formRules:{}}),computed:{localData(){const t=this.model||this.modelValue||this.value;return t?(e=t,JSON.parse(JSON.stringify(e))):{};var e}},watch:{rules:{handler:function(t,e){this.setRules(t)},deep:!0,immediate:!0}},created(){y().$vm.$.appContext.config.globalProperties.binddata||(y().$vm.$.appContext.config.globalProperties.binddata=function(t,e,i){if(i)this.$refs[i].setValue(t,e);else{let i;for(let t in this.$refs){const e=this.$refs[t];if(e&&e.$options&&"uniForms"===e.$options.name){i=e;break}}if(!i)return console.error("当前 uni-froms 组件缺少 ref 属性");i.setValue(t,e)}}),this.childrens=[],this.inputChildrens=[],this.setRules(this.rules)},methods:{setRules(t){this.formRules=Object.assign({},this.formRules,t),this.validator=new P(t)},setValue(t,e){let i=this.childrens.find((e=>e.name===t));return i?(this.formData[t]=O(0,e,this.formRules[t]&&this.formRules[t].rules||[]),i.onFieldChange(this.formData[t])):null},validate(t,e){return this.checkAll(this.formData,t,e)},validateField(t=[],e){t=[].concat(t);let i={};return this.childrens.forEach((e=>{const s=N(e.name);-1!==t.indexOf(s)&&(i=Object.assign({},i,{[s]:this.formData[s]}))})),this.checkAll(i,[],e)},clearValidate(t=[]){t=[].concat(t),this.childrens.forEach((e=>{if(0===t.length)e.errMsg="";else{const i=N(e.name);-1!==t.indexOf(i)&&(e.errMsg="")}}))},submit(t,e,i){for(let s in this.dataValue){this.childrens.find((t=>t.name===s))&&void 0===this.formData[s]&&(this.formData[s]=this._getValue(s,this.dataValue[s]))}return i||console.warn("submit 方法即将废弃，请使用validate方法代替！"),this.checkAll(this.formData,t,e,"submit")},async checkAll(t,e,i,s){if(!this.validator)return;let a,r=[];for(let u in t){const t=this.childrens.find((t=>N(t.name)===u));t&&r.push(t)}i||"function"!=typeof e||(i=e),!i&&"function"!=typeof i&&Promise&&(a=new Promise(((t,e)=>{i=function(i,s){i?e(i):t(s)}})));let n=[],o=JSON.parse(JSON.stringify(t));for(let u in r){const t=r[u];let e=N(t.name);const i=await t.onFieldChange(o[e]);if(i&&(n.push(i),"toast"===this.errShowType||"modal"===this.errShowType))break}Array.isArray(n)&&0===n.length&&(n=null),Array.isArray(e)&&e.forEach((t=>{let e=N(t),i=F(t,this.localData);void 0!==i&&(o[e]=i)})),"submit"===s?this.$emit("submit",{detail:{value:o,errors:n}}):this.$emit("validate",n);let l={};return l=((t={},e)=>{let i=JSON.parse(JSON.stringify(t)),s={};for(let a in i){let t=V(a);L(s,t,i[a])}return s})(o,this.name),i&&"function"==typeof i&&i(n,l),a&&i?a:null},validateCheck(t){this.$emit("validate",t)},_getValue:O,_isRequiredField:t=>{let e=!1;for(let i=0;i<t.length;i++){if(t[i].required){e=!0;break}}return e},_setDataValue:(t,e,i)=>(e[t]=i,i||""),_getDataValue:F,_realName:N,_isRealName:t=>/^_formdata_#*/.test(t),_isEqual:(t,e)=>{if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;var i=toString.call(t);if(i!==toString.call(e))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e}if("[object Object]"==i){var s=Object.getOwnPropertyNames(t),a=Object.getOwnPropertyNames(e);if(s.length!=a.length)return!1;for(var r=0;r<s.length;r++){var n=s[r];if(t[n]!==e[n])return!1}return!0}return"[object Array]"==i?t.toString()==e.toString():void 0}}},[["render",function(t,r,n,o,u,h){const d=k,c=l;return e(),i(c,{class:"uni-forms"},{default:s((()=>[m(d,null,{default:s((()=>[a(t.$slots,"default",{},void 0,!0)])),_:3})])),_:3})}],["__scopeId","data-v-bc3907b2"]]);export{A as _,T as a,W as b};
