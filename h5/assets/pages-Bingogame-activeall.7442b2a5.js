import{a as e,r as t,t as a,V as s,aU as l,s as i,an as d,f as o,g as r,w as c,i as n,z as u,u as f,k as m,l as p,m as y,j as h,n as b,aV as _,a0 as v,aW as I,E as g,y as x,x as A,aq as D,ay as w}from"./index.1a866322.js";import{_ as k}from"./u-parse.58a54c5b.js";import{o as T,a as B,r as j}from"./uni-app.es.5638d019.js";import{_ as M}from"./u-icon.1541541b.js";import{a as P,b as z,_ as G}from"./uni-forms.90eb198d.js";import{_ as V,a as C}from"./u-radio-group.12866b1c.js";import{n as S,j as L,g as U}from"./methods.10d71805.js";import{u as q}from"./useState.33e874ff.js";import{w as R}from"./wechatSdk.8caabd54.js";import{_ as O}from"./plugin-vue_export-helper.21dcd24c.js";import"./emitter.5b880544.js";import"./index.0e6263ad.js";var $=O({__name:"activeall",setup(O){const $=O,F=q(["islogin","saveOem","AddressChoose","userinfo"]);console.log("路由===>",$),e(200);const N=e(0),E=e(0),K=t({MerchantData:{},ProductData:{},GetActivityByIdDate:{},ApplyActivityDate:{name:"",phone:"",sex:"",address:"",remark:"",activityId:$.Id,school:""},SkuListData:[],basicPrice:{},StudentId:"",studentList:[],rules:{name:{rules:[{required:!0,errorMessage:"姓名不能为空"}]},phone:{rules:[{required:!0,errorMessage:"电话不能为空"},{pattern:"(^1([358][0-9]|4[579]|66|7[0135678]|9[89])[0-9]{8}$)",errorMessage:"电话错误"}]}},addressList:[]}),{MerchantData:J,ApplyActivityDate:W,ProductData:Y,SkuListData:H,GetActivityByIdDate:Q,basicPrice:X,StudentId:Z,studentList:ee,rules:te,addressList:ae}=a(K),{islogin:se,saveOem:le,AddressChoose:ie,userinfo:de}=F;e(!1),e(50),e(!1),e(0);const oe=e(0),re=e(null),ce=e(0),ne=e(null);async function ue(){const e={merchantId:$.MerchantId,id:$.Id};let t=await l(e);K.GetActivityByIdDate=t.Result,console.log("baga10",t),ce.value=K.GetActivityByIdDate.IsPay,oe.value=K.GetActivityByIdDate.Price,K.GetActivityByIdDate.TimeK="";var a=Date.now();new Date(K.GetActivityByIdDate.BeginTime).getTime();let s=new Date(K.GetActivityByIdDate.EndTime).getTime();N.value=a,E.value=s,a>s&&(K.GetActivityByIdDate.TimeK=!0),i({title:t.Result.Title}),1==K.GetActivityByIdDate.IsApply?re.value.close():1==K.GetActivityByIdDate.IsSuccessPay&&re.value.open(),function(e){let t=window.location.href,a=e;console.log("分享信息==>",a),R({share_title:a.Title,share_desc:a.Organizer+"，地址："+a.Address,share_link:t,share_cover:a.Img})}(t.Result)}function fe(){se.value?1!=K.GetActivityByIdDate.IsSuccessPay?function(){if(se.value){let e={},t={ProductId:K.GetActivityByIdDate.Product.Id,ShopNumber:1,Specs:K.GetActivityByIdDate.Title,Price:K.GetActivityByIdDate.Price,Picture:K.GetActivityByIdDate.Img,Title:K.GetActivityByIdDate.Title};e={BuyProduct:JSON.stringify([{...t}]),MerchantId:$.MerchantId},I(e).then((e=>{const t=e.Message;if(t)v({icon:"none",title:t,duration:3e3});else{const t=e.Result;"object"==typeof t&&(console.log("有没有进else",t||""),g({url:`../createOrder/index?Id=${t.Id}&MerchantId=${$.MerchantId}&activeId=${$.Id}`}))}})).catch((e=>{}))}else U({url:window.location.href},!0)}():re.value.open():U({url:window.location.href},!0)}return T((()=>{$&&$.MerchantId||location.replace("https://appwx.xuezhilian.com/xzb/index.html#/pages/error/404")})),B((()=>{ue(),function(){if(!se.value)return;d({permission:"Shop-Address",queryField:"Id,UserName,Address,Mobile,DefaultChoose,DefaultChooseText",entityName:"CirclesFinancial.Modals.Shop.OrderAddress",whereField:"{}"}).then((e=>{const t=e.Result;t&&"object"==typeof t&&t.length>0&&(K.addressList=t,K.ApplyActivityDate.phone=t[ie.value].Mobile||"",K.ApplyActivityDate.name=t[ie.value].UserName||"",K.ApplyActivityDate.Address=t[ie.value].Address||"")})).catch((e=>{}))}(),$&&3085==$.MerchantId&&s({title:"提示",content:"本站为“学支联公众号版”演示站点，内容及课程为演示数据。请勿报名！",showCancel:!1,confirmColor:"#fd8b27",confirmText:"我知道了"})})),(e,t)=>{const a=x,s=n,l=j(A("u-parse"),k),i=j(A("u-icon"),M),d=D,I=w,g=j(A("uni-forms-item"),P),T=j(A("u-radio"),V),B=j(A("u-radio-group"),C),q=j(A("uni-forms"),z),R=j(A("uni-popup"),G);return o(),r(s,{class:"anquan"},{default:c((()=>[u("img",{style:{width:"100%",height:"500rpx"},src:f(Q).Img,alt:""},null,8,["src"]),m(s,{class:"page"},{default:c((()=>[m(s,{class:"merch-detail"},{default:c((()=>[m(s,{class:"moneyDiv colorBC"},{default:c((()=>[m(a,{class:"font-weight-600",selectable:!0},{default:c((()=>[p(y(f(Q).Title),1)])),_:1})])),_:1}),m(s,{class:"merch-tag flex justify-between mt-2"},{default:c((()=>[m(s,{class:""},{default:c((()=>[m(s,{class:"flex mb-1"},{default:c((()=>[m(a,{selectable:!0,style:{"font-size":"32rpx",color:"#646464"}},{default:c((()=>[p("开始时间:")])),_:1}),m(a,{selectable:!0,class:"mainType"},{default:c((()=>[p(y(f(Q).BeginTimes),1)])),_:1})])),_:1}),m(s,{class:"mb-1"},{default:c((()=>[m(a,{selectable:!0,style:{"font-size":"32rpx",color:"#646464"}},{default:c((()=>[p("结束时间:")])),_:1}),m(a,{selectable:!0,class:"mainType"},{default:c((()=>[p(y(f(Q).EndTimes),1)])),_:1})])),_:1}),m(s,{class:"mb-1"},{default:c((()=>[m(a,{style:{"font-size":"32rpx",color:"#646464"}},{default:c((()=>[p("报名开始:")])),_:1}),m(a,{class:"mainType"},{default:c((()=>[p(y(f(Q).ApplyBeginTimes),1)])),_:1})])),_:1}),m(s,{class:"mb-1"},{default:c((()=>[m(a,{style:{"font-size":"32rpx",color:"#646464"}},{default:c((()=>[p("报名结束:")])),_:1}),m(a,{class:"mainType"},{default:c((()=>[p(y(f(Q).ApplyEndTimes),1)])),_:1})])),_:1})])),_:1})])),_:1}),m(s,{class:"merch-tag flex justify-between"},{default:c((()=>[m(s,{class:""},{default:c((()=>[m(a,{selectable:!0,style:{"font-size":"32rpx",color:"#646464"}},{default:c((()=>[p("活动地址:")])),_:1}),m(a,{selectable:!0,class:"mainTypeY"},{default:c((()=>[p(y(f(Q).Address),1)])),_:1})])),_:1})])),_:1}),m(s,{class:"moneyDiv font-md color-main"},{default:c((()=>[m(a,{style:{"font-size":"32rpx",color:"#646464"}},{default:c((()=>[p("费用:")])),_:1}),1==f(Q).IsPay?(o(),r(a,{key:0,class:"font-small"},{default:c((()=>[p("￥")])),_:1})):h("v-if",!0),1==f(Q).IsPay?(o(),r(a,{key:1,class:"font-weight-600"},{default:c((()=>[p(y(f(Q).Price),1)])),_:1})):(o(),r(a,{key:2,class:"font-weight-500"},{default:c((()=>[p(" 免费")])),_:1}))])),_:1})])),_:1})])),_:1}),u("img",{style:{width:"100%",height:"400rpx"},src:f(Q).Img,alt:""},null,8,["src"]),m(s,{class:"page"},{default:c((()=>[m(s,{class:"merch-detail"},{default:c((()=>[m(s,{class:"moneyDiv colorBC"},{default:c((()=>[m(l,{html:f(Q).Remark,"lazy-load":!0},null,8,["html"])])),_:1})])),_:1})])),_:1}),m(s,{class:"btn-con flex align-center justify-between",style:b("android"==f(L)()?"padding-bottom: 14rpx;":""),id:"btnBox"},{default:c((()=>[m(s,{class:"w-20 flex justify-around"},{default:c((()=>[m(i,{name:"home",label:"官网",color:"#fd8b27",size:"40","label-pos":"bottom","label-size":"24",onClick:t[0]||(t[0]=e=>f(S)(`/pages/index/index?MerchantId=${$.MerchantId}`))}),h(' <u-icon name="kefu-ermai" label="客服" color="#fd8b27" size="40" label-pos="bottom" label-size="24"\r\n\t\t\t\t@click="navTo(`/pages/chat/index?MerchantId=${props.MerchantId}`)"></u-icon> '),h(' <u-icon :name="favorite ? \'star-fill\' : \'star\'" label="收藏" color="#fd8b27" size="40" label-pos="bottom"\r\n\t\t\t\t\tlabel-size="24"></u-icon> ')])),_:1}),f(Q).TimeK?(o(),r(d,{key:0,disabled:f(Q).TimeK,class:"pop-btn text-white"},{default:c((()=>[p("已结束")])),_:1},8,["disabled"])):(o(),r(d,{key:1,disabled:f(Q).IsApply>0,class:"pop-btn text-white",onClick:t[1]||(t[1]=e=>2==f(Q).IsPay?function(){if(se.value){if(Q.IsApply>0)return;re.value.open()}else U({url:window.location.href},!0)}():fe())},{default:c((()=>[p(y(f(Q).IsApply>0?"已报名":"立即报名"),1)])),_:1},8,["disabled"]))])),_:1},8,["style"]),m(R,{ref_key:"popup",ref:re,type:"center"},{default:c((()=>[m(s,{class:"pop-ke"},{default:c((()=>[1==f(Q).IsPay?(o(),r(s,{key:0,style:{width:"100%",height:"70rpx",display:"flex","justify-content":"center","align-items":"center"}},{default:c((()=>[p(" 已支付成功,快填写报名吧")])),_:1})):h("v-if",!0),2==f(Q).IsPay?(o(),r(s,{key:1,style:{width:"100%",height:"70rpx",display:"flex","justify-content":"center","align-items":"center"}},{default:c((()=>[p(" 快填写报名参与活动吧")])),_:1})):h("v-if",!0),m(s,{class:"example"},{default:c((()=>[m(q,{ref_key:"baseForm",ref:ne,rules:f(te),model:f(W)},{default:c((()=>[m(g,{label:"姓名",required:"",name:"name"},{default:c((()=>[m(I,{class:"addsub",type:"text",placeholder:"请填写姓名",modelValue:f(W).name,"onUpdate:modelValue":t[2]||(t[2]=e=>f(W).name=e)},null,8,["modelValue"])])),_:1}),m(g,{class:"addsubs",label:"电话",required:"",name:"phone"},{default:c((()=>[m(I,{class:"addsub",type:"number",maxlength:"11",placeholder:"请填写电话",modelValue:f(W).phone,"onUpdate:modelValue":t[3]||(t[3]=e=>f(W).phone=e)},null,8,["modelValue"])])),_:1}),m(g,{class:"addsubs",label:"性别",name:"sex"},{default:c((()=>[m(B,{modelValue:f(W).sex,"onUpdate:modelValue":t[4]||(t[4]=e=>f(W).sex=e)},{default:c((()=>[m(T,{name:1},{default:c((()=>[p("男")])),_:1}),m(T,{name:2,"active-color":"#F6ABC0"},{default:c((()=>[p("女")])),_:1})])),_:1},8,["modelValue"])])),_:1}),m(g,{class:"addsubs",label:"联系地址"},{default:c((()=>[m(I,{class:"addsub",type:"text",value:"",placeholder:"请填写详细地址",modelValue:f(W).Address,"onUpdate:modelValue":t[5]||(t[5]=e=>f(W).Address=e),onClick:t[6]||(t[6]=e=>f(S)("../address/index"))},null,8,["modelValue"])])),_:1}),m(g,{class:"addsubs",label:"备注",name:"remark"},{default:c((()=>[m(I,{class:"addsub",type:"textarea",value:"",placeholder:"填写备注",modelValue:f(W).remark,"onUpdate:modelValue":t[7]||(t[7]=e=>f(W).remark=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"]),m(d,{type:"primary",onClick:t[8]||(t[8]=e=>async function(){ne.value.validate().then((e=>{const t={merchantId:$.MerchantId,activityId:$.Id,address:K.addressList[ie.value].Id,...e};console.log("success",t),_(t).then((e=>{e&&"success"==e.Result&&(re.value.close(),v({icon:"success",title:"提交成功",duration:3e3}),ue())})).catch((e=>{}))})).catch((e=>{console.log("err",e)}))}())},{default:c((()=>[p("提交")])),_:1})])),_:1})])),_:1}),h(' <view style="width: 100%;height: 100rpx;display: flex;justify-content: center;" @click="close">\r\n\t\t\t\t\t<p style="font-size: 120rpx;">×</p>\r\n\t\t\t\t</view> ')])),_:1},512)])),_:1})}}},[["__scopeId","data-v-40be2901"]]);export{$ as default};
