import{r as e,t as a,a as l,s as t,ab as s,ad as u,bh as n,af as o,f as c,g as d,w as i,i as r,k as f,j as m,l as v,m as h,p as _,q as g,F as p,u as b,a0 as x,bi as I,b0 as C,y as T,C as k,x as y,v as S,n as j,bj as D,a4 as w,bk as N,aL as V,aq as $}from"./index.1a866322.js";import{_ as L}from"./u-popup.ac74065a.js";import{o as O,a as P,c as M,b as H,r as z}from"./uni-app.es.5638d019.js";import{_ as B,a as E}from"./u-radio-group.12866b1c.js";import{_ as R}from"./u-input.afd7c546.js";import{_ as U}from"./u-button.9dd62910.js";import{T as A,h as q,f as F}from"./methods.10d71805.js";import{u as W}from"./useState.33e874ff.js";import{_ as G}from"./plugin-vue_export-helper.21dcd24c.js";import"./u-icon.1541541b.js";import"./emitter.5b880544.js";import"./index.0e6263ad.js";var J=G({__name:"classTable",setup(G){const J=G;console.log("路由===>",J),W(["MerchantId","islogin","InformationData"]);const K=e({userObj:{},signObj:{},tableList:[],leaveData:{}}),{userObj:Q,tableList:X,signObj:Y,leaveData:Z}=a(K),ee=l(!1),ae=l(!1),le=l(!0),te=l(""),se=l(""),ue=l(""),ne=l("");l("");const oe=l(0),ce=l("");let de=null;const ie=l(10),re=l(2),fe=l(0),me=l(1),ve=l(["日","一","二","三","四","五","六"]),he=l([{key:1,value:"已排课"},{key:2,value:"往期排课"},{key:3,value:"已上[已核销]"},{key:4,value:"缺课(未核销)"}]);function _e(e){let a=K.tableList;u({title:"加载中",mask:!0});let l={merchantId:J.MerchantId,StudentId:K.userObj.StudentId,PageSize:ie.value,PageIndex:e,Flag:me.value,BeginTime:`${te.value} 00:00:00`,EndTime:`${ue.value} 23:59:59`};n(l).then((e=>{const t=e.Result;fe.value=e.Total,Array.isArray(t)&&t.length>0&&(t.forEach((e=>{if(e.BeginTime&&e.EndTime){const a=e.BeginTime.split(" "),l=e.EndTime.split(" ");a[0]&&a[1]&&(e.Date=a[0].replace(/-/g,"/"),e.Week=ve.value[new Date(e.Date).getDay()],e.Time1=a[1].slice(0,5),e.Time2=l[1].slice(0,5))}})),console.log("排课结果===>",l.PageIndex),K.tableList=l.PageIndex<=1?t:a.concat(t)),setTimeout((()=>{o()}),500)})).catch((e=>{o()}))}function ge(e){K.signObj={},console.log("排课结果===>",e),ee.value=!0,function(e){let a={scheduleDetailId:e.Id,studentId:K.userObj.StudentId,merchantId:J.MerchantId};le.value=!1,D(a).then((e=>{const l=e.Result;if(l){const e=F(`${w.host.api}Learning/CodeImg?code=${l}&&t=${(new Date).getTime()}`);K.signObj={Num:l,Code:e},console.log("二维码地址==>",e),de=setInterval((()=>{!function(e,a){const l={scheduleDetailId:e,studentId:a,merchantId:J.MerchantId};console.log("核销监听",l),N(l).then((e=>{e.Result&&(V(),x({title:"签到成功",mask:!0}),ee.value=!1,clearInterval(de),de=null,_e(1))})).catch((e=>{}))}(a.scheduleDetailId,a.studentId)}),2e3)}})).catch((e=>{}))}(e)}function pe(){console.log("弹窗收起"),clearInterval(de),de=null}function be(e){1===e?o():x({title:"签到码加载失败，请重试！",icon:"none"})}function xe(e){console.log("开始时间==>",e.detail.value),te.value=e.detail.value,Ce()}function Ie(e){console.log("结束时间==>",e.detail.value),ue.value=e.detail.value,Ce()}function Ce(){if(new Date(`${te.value} 00:00:00`).getTime()>new Date(`${ue.value} 23:59:59`).getTime())return uni.$u.toast("时间错误"),te.value=se.value,void(ue.value=ne.value);_e(1),console.log("时间比较==>",new Date(`${te.value} 00:00:00`).getTime(),new Date(`${ue.value} 23:59:59`).getTime())}function Te(){const e=K.leaveData;I(e).then((e=>{ae.value=!1,"success"==e.Result?x({icon:"null",title:"提交成功",duration:1500}):x({icon:"null",title:"当前时间段已经提交请假申请，请勿重复提交!",duration:1500})})).catch((e=>{}))}function ke(){K.leaveData={},ae.value=!1}return O((e=>{e.MerchantId?e.StudentId&&(K.userObj=e,te.value=A(-7),se.value=A(-7),ue.value=A(7),ne.value=A(7),_e(1),t({title:`${e.Name}的课程表`})):location.replace("https://appwx.xuezhilian.com/xzb/index.html#/pages/error/404")})),P((()=>{console.log("页面出现时")})),M((()=>{console.log("页面准备好时")})),H((()=>{let e=re.value++;K.tableList.length>=fe.value||(_e(e),console.log("触底",K.tableList.length,fe.value))})),s((()=>{clearInterval(de),de=null})),q(),(e,a)=>{const l=r,t=C,s=T,u=$,n=k,o=z(y("u-popup"),L),x=z(y("u-radio"),B),I=z(y("u-radio-group"),E),D=z(y("u-input"),R),w=z(y("u-button"),U);return c(),d(l,{class:"page classTable"},{default:i((()=>[f(l,{class:"head flex align-center mb-2"},{default:i((()=>[f(l,{class:"date-con flex align-center"},{default:i((()=>[m(' <picker mode="date" start="2022-08-17" :end="end" @change="bindDateChange"> '),f(l,{class:"font-smaller"},{default:i((()=>[v("日期：")])),_:1}),f(t,{value:te.value,mode:"date",onChange:xe},{default:i((()=>[f(l,{class:"uni-input"},{default:i((()=>[v(h(te.value),1)])),_:1})])),_:1},8,["value"]),f(l,null,{default:i((()=>[v("--")])),_:1}),f(t,{value:ue.value,mode:"date",onChange:Ie},{default:i((()=>[f(l,{class:"uni-input"},{default:i((()=>[v(h(ue.value),1)])),_:1})])),_:1},8,["value"])])),_:1}),m(" <button>查询</button> ")])),_:1}),f(l,{class:"align-center flex justify-between"},{default:i((()=>[(c(!0),_(p,null,g(he.value,((e,a)=>(c(),d(s,{onClick:a=>function(e,a){me.value!=e.key&&(K.tableList=[],me.value=e.key,_e(1))}(e),key:a,class:S(["userSP","userSText","boederA",me.value==e.key?"activeP":"noActive"])},{default:i((()=>[v(h(e.value),1)])),_:2},1032,["onClick","class"])))),128))])),_:1}),f(l,{class:"table"},{default:i((()=>[f(l,{class:"T_Cell flex mt-2"},{default:i((()=>[f(s,{class:"T_HCell wrap"},{default:i((()=>[v("时间")])),_:1}),f(s,{class:"T_HCell"},{default:i((()=>[v("班级")])),_:1}),f(s,{class:"T_HCell"},{default:i((()=>[v("教师")])),_:1}),f(s,{class:"T_HCell"},{default:i((()=>[v("状态")])),_:1})])),_:1}),b(X).length<=0?(c(),d(l,{key:0,class:"font-sm text-center mt-5 text-muted"},{default:i((()=>[v("暂无排课")])),_:1})):m("v-if",!0),(c(!0),_(p,null,g(b(X),((e,a)=>(c(),d(l,{key:a,class:"T_Cell flex w-100 mt-1"},{default:i((()=>[f(l,{class:"T_HData flex flex-column justify-center align-center"},{default:i((()=>[f(s,{class:"kcContent",style:{"font-size":"23rpx"}},{default:i((()=>[v(h(e.Date||""),1)])),_:2},1024),f(s,{class:"kcContent",style:{color:"red","font-size":"23rpx"}},{default:i((()=>[v(h(e.Time1||"00:00")+"~"+h(e.Time2||"00:00"),1)])),_:2},1024),f(s,{class:"kcContent"},{default:i((()=>[v("（周"+h(e.Week)+"）",1)])),_:2},1024)])),_:2},1024),f(l,{class:"T_HData centerDiv"},{default:i((()=>[f(s,{class:"kcName"},{default:i((()=>[v(h(e.ClassShiftName),1)])),_:2},1024)])),_:2},1024),f(l,{class:"T_HData centerDiv"},{default:i((()=>[f(s,{class:"kcContent"},{default:i((()=>[v(h(e.UserName),1)])),_:2},1024)])),_:2},1024),f(l,{class:"T_HData flex flex-column justify-around align-center"},{default:i((()=>[f(u,{disabled:0!=e.Status,class:"statusP",onClick:a=>ge(e),style:j({opacity:0==e.Status?1:.5})},{default:i((()=>[v(h(e.StatusText||"其他"),1)])),_:2},1032,["disabled","onClick","style"]),1==me.value&&0==e.Status?(c(),d(u,{key:0,class:"statusP",onClick:a=>function(e){let a={MerchantId:e.MerchantId,CourseId:e.CourseId,ClassTypeId:e.ClassTypeId,ClassShiftId:e.ClassShiftId,ShiftScheduleId:e.ShiftScheduleId,SchoolTime:e.Date+" "+e.Time1+"-"+e.Time2,ClassTypeName:e.ClassTypeName,ClassShiftName:e.ClassShiftName,StudentId:K.userObj.StudentId,StudentName:K.userObj.Name,CSScheduleDetailId:e.Id,StudentMerchantId:e.StudentMerchantId,LeaveType:oe.value,Remark:ce.value};K.leaveData=a,ae.value=!0}(e)},{default:i((()=>[v("请假")])),_:2},1032,["onClick"])):m("v-if",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),m(" 核销弹窗 "),f(o,{modelValue:ee.value,"onUpdate:modelValue":a[2]||(a[2]=e=>ee.value=e),mode:"center",onClose:pe},{default:i((()=>[f(l,{class:"hbBack flex justify-center align-center pt-4"},{default:i((()=>[f(n,{class:"hbBack-img",src:"./assets/hbBack.709ab892.png"}),m(' <view v-if="current" style="z-index:99999;" class="flex flex-column ">\n                    <text class="signP">上课打卡</text>\n                    <text class="signP">{{ toDay }}</text>\n                    <text @click="signClick" class="clickBefore">打卡签到</text>\n                </view> '),f(l,{class:"flex flex-column justify-end align-center",style:{"z-index":"99999"}},{default:i((()=>[f(s,{class:"signP",style:{height:"80rpx","line-height":"80rpx"}},{default:i((()=>[v(h(b(Y).Num),1)])),_:1}),f(n,{src:b(Y).Code,onLoad:a[0]||(a[0]=e=>be(1)),onError:a[1]||(a[1]=e=>be(2)),mode:"",class:"codeImg"},null,8,["src"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),m(" 请假弹窗 "),f(o,{modelValue:ae.value,"onUpdate:modelValue":a[6]||(a[6]=e=>ae.value=e),mode:"center"},{default:i((()=>[f(l,{class:"leave-box"},{default:i((()=>[f(l,{class:"text-center font-sm font-weight-600"},{default:i((()=>[v("请假申请")])),_:1}),b(Z).ClassShiftName?(c(),d(l,{key:0,class:"msg-con font-small"},{default:i((()=>[f(l,null,{default:i((()=>[v("名字："+h(b(Q).Name),1)])),_:1}),f(l,null,{default:i((()=>[v("班级名称："+h(b(Z).ClassShiftName),1)])),_:1}),f(l,null,{default:i((()=>[v("时间："+h(b(Z).SchoolTime),1)])),_:1}),f(l,null,{default:i((()=>[v("申请原因： "),f(I,{modelValue:oe.value,"onUpdate:modelValue":a[3]||(a[3]=e=>oe.value=e)},{default:i((()=>[f(x,{name:0},{default:i((()=>[v("事假")])),_:1}),f(x,{name:1},{default:i((()=>[v("病假")])),_:1}),f(x,{name:2},{default:i((()=>[v("其他")])),_:1})])),_:1},8,["modelValue"])])),_:1}),f(l,null,{default:i((()=>[v("情况说明")])),_:1}),f(D,{modelValue:ce.value,"onUpdate:modelValue":a[4]||(a[4]=e=>ce.value=e),type:"textarea",border:!0,height:100,"auto-height":!0},null,8,["modelValue"]),f(l,{class:"flex justify-around mt-2"},{default:i((()=>[f(w,{class:"w-40 btn","hair-line":"",plain:"",shape:"circle",onClick:ke},{default:i((()=>[v("取消")])),_:1}),f(w,{class:"w-40 btn-confirm",shape:"circle",onClick:a[5]||(a[5]=a=>e.$u.throttle(Te,500))},{default:i((()=>[v("确认 ")])),_:1})])),_:1})])),_:1})):m("v-if",!0)])),_:1})])),_:1},8,["modelValue"])])),_:1})}}},[["__scopeId","data-v-495cd084"]]);export{J as default};
